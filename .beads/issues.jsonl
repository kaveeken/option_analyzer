{"id":"option_returns-0on","title":"Phase 2: Statistical Engine","description":"Price distribution modeling and risk metrics\n\nTasks:\n- [ ] Implement geometric returns, bootstrap\n- [ ] Direct returns vs Monte Carlo modes\n- [ ] Price range calculation (auto + user override)\n- [ ] Histogram binning\n- [ ] Risk metrics (EV, PoP) with transaction costs\n- [ ] Comprehensive unit tests\n- [ ] Performance benchmarks (bootstrap simulation)\n\nDeliverables:\n- Bootstrap simulation (10k samples \u003c5s)\n- Price distribution functions\n- Risk calculation engine\n- Test coverage \u003e90%\n\nSuccess Criteria:\n- 10,000 simulations complete in \u003c5 seconds\n- Price range auto-calculated with 5% padding\n- Transaction costs included in all metrics","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-19T21:53:21.821557539+01:00","updated_at":"2025-12-28T01:12:19.690085609+01:00","closed_at":"2025-12-28T01:12:19.690085609+01:00","close_reason":"All Phase 2 components implemented and tested: Statistics Module (i75), Risk Metrics Module (eiu), unit tests with \u003e90% coverage (ba7, ukg), and performance benchmarks validating \u003c5s for 10k simulations (eav). All deliverables complete.","dependencies":[{"issue_id":"option_returns-0on","depends_on_id":"option_returns-yaf","type":"blocks","created_at":"2025-12-19T21:54:20.9232971+01:00","created_by":"daemon"},{"issue_id":"option_returns-0on","depends_on_id":"option_returns-i75","type":"blocks","created_at":"2025-12-21T21:42:38.379669001+01:00","created_by":"daemon"},{"issue_id":"option_returns-0on","depends_on_id":"option_returns-eiu","type":"blocks","created_at":"2025-12-21T21:42:38.417580431+01:00","created_by":"daemon"},{"issue_id":"option_returns-0on","depends_on_id":"option_returns-ba7","type":"blocks","created_at":"2025-12-21T21:42:38.453247257+01:00","created_by":"daemon"},{"issue_id":"option_returns-0on","depends_on_id":"option_returns-ukg","type":"blocks","created_at":"2025-12-21T21:42:38.491892013+01:00","created_by":"daemon"},{"issue_id":"option_returns-0on","depends_on_id":"option_returns-eav","type":"blocks","created_at":"2025-12-21T21:42:38.52741603+01:00","created_by":"daemon"}]}
{"id":"option_returns-1h0","title":"Implement comprehensive health and readiness checks","description":"Current /health endpoint only checks if API server is running (liveness), but doesn't verify dependencies like IBKR connectivity (readiness).\n\nFor production deployments, need separate liveness and readiness checks:\n\n**Liveness Check** (/health/live):\n- Is the process alive?\n- Used by orchestrators to restart crashed containers\n- Should be fast and not check external dependencies\n- Current /health endpoint can be this\n\n**Readiness Check** (/health/ready):\n- Can the service handle requests?\n- Check IBKR connectivity (ping /iserver/auth/status)\n- Check session service initialized\n- Return 503 if not ready\n- Used by load balancers for routing decisions\n\n**IBKR Auth Status Response Format:**\n```json\n{\n  \"authenticated\": true,\n  \"competing\": false,\n  \"connected\": true,\n  \"message\": \"\",\n  \"MAC\": \"XX:XX:XX:XX:XX:XX\",\n  \"serverInfo\": {\n    \"serverName\": \"JifZ12345\",\n    \"serverVersion\": \"Build 10.41.1f, Dec 16, 2025 10:44:32 AM\"\n  },\n  \"hardware_info\": \"\u003chardware-id\u003e\",\n  \"fail\": \"\"\n}\n```\n\nHealth check should verify:\n- `authenticated == true`\n- `connected == true`\n- `fail == \"\"` (empty string means no failures)\n\nImplementation:\n- Add /health/ready endpoint\n- Add /health/live endpoint (move current /health here)\n- Keep /health as alias to /health/live for backwards compatibility\n- Extend HealthCheckResponse schema with optional details field\n- Add timeout to IBKR connectivity check (5s max)\n- Return detailed status in response body\n\nResponse format:\n```json\n{\n  \"status\": \"healthy\",\n  \"version\": \"0.1.0\",\n  \"checks\": {\n    \"ibkr\": \"connected\",\n    \"session_service\": \"ok\",\n    \"cache\": \"ok\"\n  }\n}\n```\n\nFiles:\n- src/option_analyzer/api/routes/health.py (add endpoints)\n- src/option_analyzer/api/schemas.py (extend HealthCheckResponse)\n- tests/unit/test_api_endpoints.py (add tests)\n\nReference: https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T12:27:59.99509978+01:00","updated_at":"2026-01-02T12:33:05.57017908+01:00"}
{"id":"option_returns-1ze","title":"Export IBKRClient from clients/__init__.py","description":"clients/__init__.py exports CacheInterface and InMemoryCache but not IBKRClient. Users must import from clients.ibkr directly. Add IBKRClient to __all__ for consistent public API.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T18:36:58.388756994+01:00","updated_at":"2025-12-31T18:36:58.388756994+01:00"}
{"id":"option_returns-2kj","title":"Design relationship between OptionContract/OptionChain and Stock","description":"## Current State\n\n- OptionContract has no reference to its underlying stock\n- OptionChain has no reference to its underlying stock  \n- Stock has available_expirations metadata but not full chains\n- Relationship only established at Strategy level (Strategy has both Stock and OptionPositions)\n\n## Problem\n\nWithout a reference to the underlying:\n- Cannot validate that options in a Strategy match the Stock\n- Chain objects are context-free (can't tell what stock a chain is for after fetching)\n- Error messages and debugging are harder\n- Potential for mixing up stocks and chains at runtime\n\n## Proposed Solutions\n\n### Option 1: No reference (pure value objects)\n- OptionChain and OptionContract remain context-free\n- Relationship established only at Strategy/container level\n- Relies on discipline to avoid mixing stocks and chains\n\n**Pros:** Simple, no duplication, lightweight objects\n**Cons:** No validation, context can be lost\n\n### Option 2: Symbol string in OptionChain only\n- Add `symbol: str` to OptionChain for validation\n- OptionContract remains a value object\n- Enables validation at Strategy level\n\n**Pros:** Minimal duplication, enables validation, self-documenting chains\n**Cons:** Still can't validate individual contracts\n\n### Option 3: Full Stock object in OptionChain\n- Add `underlying: Stock` to OptionChain\n- Have both stock data and options in one object\n- Already done this way in Strategy\n\n**Pros:** Complete data, matches Strategy pattern, convenient\n**Cons:** Heavier objects, tight coupling\n\n### Option 4: Symbol in both OptionChain and OptionContract\n- Add `underlying_symbol: str` to both models\n- Maximum validation capability\n\n**Pros:** Full validation, self-documenting at all levels\n**Cons:** Most duplication, symbol repeated in every contract\n\n## Related Issues\n\nThis relates to the broader question of IBKR API coupling (conids in domain models). Both are about what provider-specific or contextual information belongs in domain models.\n\n## Decision Needed\n\nChoose an approach based on priorities:\n- Validation safety vs simplicity\n- Object weight vs convenience  \n- Type safety vs flexibility","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T15:20:35.917220549+01:00","updated_at":"2025-12-31T15:20:35.917220549+01:00"}
{"id":"option_returns-2n8","title":"Implement breakeven price calculation in Risk module","description":"Calculate breakeven prices where strategy.total_payoff(price) == 0.\n\nCurrently returns empty list (risk.py:198). Need to:\n- Find roots of total_payoff function across price range\n- Handle strategies with 0, 1, 2+ breakevens\n- Consider numerical precision for root finding\n- Add validation for edge cases\n\nDepends on: Risk module already has TODO comment marking this location.","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-27T17:19:30.171458018+01:00","updated_at":"2025-12-27T17:19:30.171458018+01:00"}
{"id":"option_returns-2o0","title":"Fix CORS wildcard for production","description":"app.py:100 uses allow_origins=['*'] which is insecure for production.\n\nCurrent:\nallow_origins=['*']  # TODO: Restrict in production\n\nSolution:\n# config.py\ncors_origins: list[str] = ['http://localhost:3000']  # Override via env\n\n# app.py\nsettings = get_settings()\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=settings.cors_origins,\n    ...\n)\n\nFiles:\n- src/option_analyzer/config.py (add cors_origins setting)\n- src/option_analyzer/api/app.py:96-104 (use settings)\n- .env.example (document CORS_ORIGINS)\n\nTesting: Verify OPTIONS preflight requests, verify origin validation","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-01T22:18:12.068727587+01:00","updated_at":"2026-01-01T22:18:12.068727587+01:00"}
{"id":"option_returns-2o5","title":"Standardize singleton pattern across services","description":"Inconsistent singleton patterns make code confusing and harder to test.\n\nCurrent state:\n- dependencies.py:20-22 uses module-level _cache, _rate_limiter\n- session.py:121 uses function-level _session_service\n- app.py:20-21 uses module-level _cleanup_task, _shutdown_event\n\nRecommendation: Move to FastAPI app.state for all singletons.\n\nBenefits:\n- Consistent pattern\n- Easier testing (can override app.state)\n- No module-level mutation\n- Clear lifecycle management\n\nFiles affected:\n- src/option_analyzer/api/dependencies.py\n- src/option_analyzer/services/session.py\n- src/option_analyzer/api/app.py\n\nNote: This is a refactoring task, not urgent but improves maintainability.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-01T22:18:12.454077849+01:00","updated_at":"2026-01-01T22:18:12.454077849+01:00"}
{"id":"option_returns-2zu","title":"Handle unbounded strategies in max_gain/max_loss calculation","description":"Current implementation (risk.py:191-194) calculates max gain/loss from histogram range only.\n\nIssue: For strategies with unlimited upside (e.g., long call) or downside (e.g., short call), should return None instead of histogram boundary values.\n\nApproach:\n- Detect unbounded strategies (check option positions for uncovered short/long)\n- Return None for max_gain when upside unlimited\n- Return None for max_loss when downside unlimited\n- RiskMetrics model already supports None for these fields\n\nBenefits: More accurate representation of true risk profile.","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-27T17:19:37.637555122+01:00","updated_at":"2025-12-27T17:19:37.637555122+01:00"}
{"id":"option_returns-444","title":"Remove symbol and underlying_price fields from OptionChain model","description":"Remove symbol and underlying_price fields from OptionChain domain model. These fields logically belong with the Stock object.\n\nChanges needed:\n1. src/option_analyzer/models/domain.py - Remove symbol and underlying_price field declarations, update docstring\n2. src/option_analyzer/clients/ibkr.py - Update get_unprice_option_chain to remove symbol parameter from OptionChain constructor\n3. tests/unit/test_models.py - Update 5 test methods that create OptionChain instances, remove test_option_chain_requires_positive_price test","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T12:08:19.31362233+01:00","updated_at":"2025-12-31T12:11:28.404397247+01:00","closed_at":"2025-12-31T12:11:28.404397247+01:00","close_reason":"Closed"}
{"id":"option_returns-4cu","title":"Document or validate negative days_to_expiry behavior","description":"The days_to_expiry() method can return negative values when reference_date is after expiration, but this is undocumented.\n\nIssues:\n- Unclear if negative values are intentional (for historical analysis) or a bug\n- No documentation about this edge case\n- No tests for past expiration scenarios\n- Calculations using this value might assume positive values\n\nSolution: Either add explicit documentation explaining negative values are allowed for historical analysis, OR add validation to raise ValueError if reference_date \u003e expiration.\n\nFile: src/option_analyzer/models/domain.py:90-101","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T09:22:09.487959694+01:00","updated_at":"2025-12-21T16:19:13.01000432+01:00","closed_at":"2025-12-21T16:19:13.01000432+01:00","close_reason":"Added validation to raise ValueError when reference_date is after expiration. Updated docstring and added comprehensive test coverage."}
{"id":"option_returns-4jo","title":"Remove unused default_historical_years config setting","description":"Config setting default_historical_years=5 is defined but never used. IBKRClient hardcodes default to 3 years. Either use the config value or remove the setting for consistency.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T18:36:57.919828643+01:00","updated_at":"2025-12-31T18:36:57.919828643+01:00"}
{"id":"option_returns-4p7","title":"Validate that first IBKR secdef/search result is always correct","description":"In get_conid() and get_stock(), we assume the first result from IBKR secdef/search is the correct/SMART choice (see ibkr.py:129). This assumption is not validated. Need to investigate: 1) Whether IBKR guarantees ordering, 2) If we should match on additional fields (exchange, currency, etc), 3) Add validation/filtering logic if needed.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T20:30:17.691247097+01:00","updated_at":"2025-12-28T20:30:17.691247097+01:00"}
{"id":"option_returns-6ik","title":"Implement Historical Data Endpoint","description":"Implement get_historical_data(symbol, years) -\u003e dict method. Uses /historical/{conid} endpoint. Cache integration with 24h TTL. Mock-based unit tests. Returns data suitable for Phase 2 geometric returns calculation.\n\n**Scope**: Basic implementation for 1-3 years (within IBKR's 1000 data point limit).\n\n**Implementation Details**:\n- Daily bars (\"1d\")\n- Max 3 years per request (no chunking - see option_returns-myc for \u003e3 year support)\n- Return format: {\"symbol\": str, \"prices\": [{\"date\": str, \"close\": float}, ...]}\n- Cache with 24h TTL\n\n**Testing Requirements**:\n- Success cases (1-3 years)\n- Caching behavior with 24h TTL\n- Error handling (invalid conid, API errors, connection failures)\n- Date formatting validation\n- Input validation (positive years, max 3)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:51:16.468395338+01:00","updated_at":"2025-12-31T17:56:17.954035084+01:00","closed_at":"2025-12-31T17:56:17.954035084+01:00","close_reason":"Closed","dependencies":[{"issue_id":"option_returns-6ik","depends_on_id":"option_returns-ouf","type":"blocks","created_at":"2025-12-21T21:51:25.687832717+01:00","created_by":"daemon"},{"issue_id":"option_returns-6ik","depends_on_id":"option_returns-7xh","type":"blocks","created_at":"2025-12-21T21:51:25.720928334+01:00","created_by":"daemon"}]}
{"id":"option_returns-6sb","title":"Add config validation on application startup","description":"Validate critical configuration on startup: (1) Check IBKR_BASE_URL is reachable (optional warning), (2) Validate numeric ranges (timeout \u003e 0, TTL \u003e 0), (3) Log loaded configuration (sanitized, no secrets), (4) Fail fast if required config is invalid.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-02T23:12:42.687915447+01:00","updated_at":"2026-01-02T23:12:42.687915447+01:00"}
{"id":"option_returns-73q","title":"Strategy Analysis Endpoint","description":"Implement POST /api/strategy/analyze endpoint. Integrate statistics service (Monte Carlo), calculate expected return, probability of profit, price distribution.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-31T18:53:49.432395042+01:00","updated_at":"2026-01-02T16:21:31.034024438+01:00","closed_at":"2026-01-02T16:21:31.034024438+01:00","close_reason":"Closed","dependencies":[{"issue_id":"option_returns-73q","depends_on_id":"option_returns-d95","type":"blocks","created_at":"2025-12-31T18:54:07.816666994+01:00","created_by":"daemon"},{"issue_id":"option_returns-73q","depends_on_id":"option_returns-dmc","type":"blocks","created_at":"2025-12-31T18:54:07.836560729+01:00","created_by":"daemon"},{"issue_id":"option_returns-73q","depends_on_id":"option_returns-qqe","type":"blocks","created_at":"2025-12-31T18:54:07.858222689+01:00","created_by":"daemon"}]}
{"id":"option_returns-7et","title":"Review and clean up unused exception types","description":"Several exceptions defined but never raised: AmbiguousSymbolError (defined but not used in symbol lookup), InsufficientDataError (not used for historical data), RateLimitedError (uses IBKRAPIError instead). Either implement usage or remove unused exceptions.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T18:36:58.852594348+01:00","updated_at":"2025-12-31T18:36:58.852594348+01:00"}
{"id":"option_returns-7xh","title":"Implement Symbol Lookup Endpoint","description":"Implement get_conid(symbol: str) -\u003e int method in IBKRClient. Uses /search or /trsrv/stocks endpoint. Cache integration with 24h TTL. Mock-based unit tests for success and error cases (symbol not found, ambiguous, API down).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:51:15.412423802+01:00","updated_at":"2025-12-28T19:20:39.678496979+01:00","closed_at":"2025-12-28T19:20:39.678496979+01:00","close_reason":"Implemented comprehensive unit tests for Symbol Lookup Endpoint (get_conid). Created tests/unit/test_ibkr.py with 19 tests covering: success cases (basic lookup, caching, 24h TTL), error cases (symbol not found, invalid responses, connection errors, API errors), cache integration, asset type parameter handling, and edge cases. All tests passing (135/135 in full suite).","dependencies":[{"issue_id":"option_returns-7xh","depends_on_id":"option_returns-ouf","type":"blocks","created_at":"2025-12-21T21:51:24.616332689+01:00","created_by":"daemon"}]}
{"id":"option_returns-85v","title":"Prevent duplicate positions in /api/strategy/positions","description":"Currently /api/strategy/positions can be called multiple times for the same contract, adding the same position multiple times.\n\nPossible solutions:\n1. Modify existing position based on the request (update instead of insert)\n2. Disallow/ignore duplicate requests\n3. Return error when attempting to add duplicate position\n\nNeed to decide on desired behavior and implement validation.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T15:34:09.291983629+01:00","updated_at":"2026-01-02T23:08:58.573097083+01:00","closed_at":"2026-01-02T23:08:58.573097083+01:00","close_reason":"Closed"}
{"id":"option_returns-8a1","title":"Fix test failure: test_snapshot_invalid_response_type","description":"Test failing with KeyError in ibkr.py:152 when market snapshot returns non-list response. Add response type validation before indexing: if not isinstance(response, list) or len(response) == 0: raise IBKRAPIError","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-02T22:55:56.934419637+01:00","updated_at":"2026-01-02T23:16:42.143262138+01:00","closed_at":"2026-01-02T23:16:42.143262138+01:00","close_reason":"Closed"}
{"id":"option_returns-8l8","title":"Add comprehensive tests for session service","description":"Zero test coverage for session.py (138 lines). Need tests for:\n\n- test_create_session() - verify unique ID generation\n- test_get_session_updates_timestamp() - verify touch() called\n- test_session_expiration() - verify is_expired() logic\n- test_cleanup_expired_sessions() - verify cleanup count\n- test_session_not_found() - verify SessionExpiredError raised\n- test_session_data_storage() - verify dict operations\n\nFiles:\n- tests/unit/test_session.py (create new)\n- src/option_analyzer/services/session.py (138 lines, 0% coverage)\n\nBlocker for Phase 5.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-01T22:18:09.871982785+01:00","updated_at":"2026-01-01T22:26:58.417947862+01:00","closed_at":"2026-01-01T22:26:58.417947862+01:00","close_reason":"Closed"}
{"id":"option_returns-8we","title":"Change domain model conid field type from string to int","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T20:27:31.650998155+01:00","updated_at":"2025-12-30T21:39:20.44780183+01:00","closed_at":"2025-12-30T21:39:20.44780183+01:00","close_reason":"Closed"}
{"id":"option_returns-9jk","title":"Profile bootstrap performance and validate \u003c5s target","description":"Validate that NumPy vectorization achieves the 10k simulations in \u003c5s performance target.\n\nProfiling tasks:\n- Benchmark 10k simulations with varying steps (10, 50, 100)\n- Profile with cProfile to identify bottlenecks\n- Test with realistic historical data sizes (252, 1000, 5000 returns)\n- Measure memory usage for large simulations\n- Document hardware specs and results\n\nIf targets not met, investigate:\n- Batch processing for memory constraints\n- numba JIT compilation\n- Alternative sampling strategies\n- Chunking large simulations\n\nSuccess criteria:\n- 10k × 50 steps completes in \u003c5s on typical hardware\n- Memory usage acceptable for realistic datasets\n- Fallback strategy documented if needed\n\nFiles: src/option_analyzer/services/statistics.py (monte_carlo_simulation)\nTests: tests/performance/test_bootstrap.py\nRelated: Phase 2 Statistical Engine","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T21:55:07.492018349+01:00","updated_at":"2025-12-21T21:55:07.492018349+01:00"}
{"id":"option_returns-a4a","title":"Add .env.example template file","description":"Create .env.example with all configurable settings documented. Include: IBKR_BASE_URL, IBKR_TIMEOUT, IBKR_VERIFY_SSL, SESSION_TTL, SESSION_CLEANUP_INTERVAL, LOG_LEVEL, etc. Add comments explaining each variable and sensible defaults.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T23:12:42.043850084+01:00","updated_at":"2026-01-02T23:12:42.043850084+01:00"}
{"id":"option_returns-a7h","title":"Enhance API documentation with examples and error codes","description":"Improvements: (1) Add comprehensive error code documentation (list all codes with meanings), (2) Add request/response examples to OpenAPI schemas, (3) Add tags/groupings to endpoints, (4) Create simple API usage guide with curl examples for common workflows.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-02T23:12:42.360614139+01:00","updated_at":"2026-01-02T23:12:42.360614139+01:00"}
{"id":"option_returns-azx","title":"Add validate_for_analysis() method to Strategy","description":"Add a comprehensive validation method to Strategy that checks if it's ready for analysis.\n\nShould validate:\n- Single expiration (all options expire on same date)\n- All option positions have valid bid/ask data\n- At least one position exists (optional)\n\nLocation: src/option_analyzer/models/domain.py (Strategy class)\n\nImplementation:\ndef validate_for_analysis(self) -\u003e None:\n    if not self.validate_single_expiration():\n        raise MixedExpirationError()\n    for pos in self.option_positions:\n        if pos.contract.bid is None or pos.contract.ask is None:\n            raise MissingBidAskError(f'Missing price data for contract {pos.contract.conid}')\n\nBenefits:\n- Fail fast before expensive calculations\n- Clear error messages\n- Single method to call before any analysis\n- Can be extended with additional validations","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:12:42.378167697+01:00","updated_at":"2025-12-21T21:15:11.38169971+01:00","closed_at":"2025-12-21T21:15:11.38169971+01:00","close_reason":"Closed"}
{"id":"option_returns-b5g","title":"Fix insecure cookie configuration","description":"strategy.py:85 sets session cookie without security flags, exposing XSS and CSRF vulnerabilities.\n\nCurrent:\nresponse.set_cookie(key=\"session_id\", value=session.session_id)\n\nRequired:\nresponse.set_cookie(\n    key=\"session_id\",\n    value=session.session_id,\n    httponly=True,      # Prevent JavaScript access (XSS protection)\n    secure=True,        # HTTPS only (MitM protection)\n    samesite=\"lax\",    # CSRF protection\n    max_age=settings.session_ttl  # Explicit expiration\n)\n\nImpact: Production security vulnerability\nFiles: src/option_analyzer/api/routes/strategy.py:85\n\nTesting: Verify cookie headers in response, test XSS prevention","status":"open","priority":4,"issue_type":"bug","created_at":"2026-01-01T22:18:10.577846587+01:00","updated_at":"2026-01-02T23:05:14.763428161+01:00","dependencies":[{"issue_id":"option_returns-b5g","depends_on_id":"option_returns-iol","type":"blocks","created_at":"2026-01-02T23:05:15.067121847+01:00","created_by":"kris"}]}
{"id":"option_returns-b8y","title":"Phase 7: Polish \u0026 Deployment","description":"Final polish and deployment readiness\n\nTasks:\n- [ ] Logging \u0026 observability\n- [ ] Performance optimization\n- [ ] Documentation\n- [ ] Deployment guide\n\nDeliverables:\n- Structured logging\n- Performance monitoring\n- User documentation\n- Deployment instructions\n\nSuccess Criteria:\n- All success criteria met\n- Documentation complete\n- Ready for single-user local deployment","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-19T21:53:23.863301009+01:00","updated_at":"2025-12-19T21:53:23.863301009+01:00","dependencies":[{"issue_id":"option_returns-b8y","depends_on_id":"option_returns-iol","type":"blocks","created_at":"2025-12-19T21:54:21.153277891+01:00","created_by":"daemon"}]}
{"id":"option_returns-b96","title":"Implement Option Chain Endpoint","description":"Implement get_option_chain(symbol, expiration) -\u003e OptionChain method. Uses /option/chain or similar endpoint. Returns both calls and puts in structured OptionChain model. Cache integration with 15min TTL. Mock-based unit tests.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:51:16.107350909+01:00","updated_at":"2025-12-31T14:28:05.976203872+01:00","closed_at":"2025-12-31T14:28:05.976203872+01:00","close_reason":"Added comprehensive mock-based unit tests covering all option chain methods: get_option_strikes, get_unpriced_option_contract, get_unpriced_option_chain, price_option_chain, and get_option_chain. Tests verify success cases, caching (15min TTL), error handling, and batching logic. All 53 tests pass.","dependencies":[{"issue_id":"option_returns-b96","depends_on_id":"option_returns-ouf","type":"blocks","created_at":"2025-12-21T21:51:25.315638062+01:00","created_by":"daemon"},{"issue_id":"option_returns-b96","depends_on_id":"option_returns-7xh","type":"blocks","created_at":"2025-12-21T21:51:25.352957984+01:00","created_by":"daemon"},{"issue_id":"option_returns-b96","depends_on_id":"option_returns-clo","type":"blocks","created_at":"2025-12-30T14:38:09.148719122+01:00","created_by":"daemon"}]}
{"id":"option_returns-ba7","title":"Unit tests for Statistics Module (\u003e90% coverage)","description":"Comprehensive unit tests for all statistical functions.\n\nDeliverables:\n- tests/unit/test_statistics.py (~500 lines)\n- Test fixtures in tests/conftest.py (returns arrays, test data)\n- ~32 unit tests across 7 test classes\n\nTest Classes:\n- TestGeometricReturns (4 tests) - basic calc, multi-period, errors\n- TestCalculatePeriodForDays (3 tests) - daily/weekly/monthly bars\n- TestBootstrapWalk (3 tests) - deterministic with seed, positive results\n- TestMonteCarloSimulation (5 tests) - shape, all positive, errors\n- TestGetPriceDistribution (5 tests) - direct/MC modes, edge cases\n- TestCalculatePriceRange (5 tests) - auto, user override, validation\n- TestCreateHistogram (7 tests) - binning, max value edge case, properties\n\nCoverage Target: \u003e90% for statistics.py\n\nTest Patterns:\n- Class-based organization\n- Fixtures from conftest.py\n- pytest.approx() and np.allclose() for floats\n- RNG seeds for reproducibility\n- Comprehensive edge cases","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T21:41:38.749005618+01:00","updated_at":"2025-12-23T14:52:11.260275555+01:00","closed_at":"2025-12-23T14:52:11.260275555+01:00","close_reason":"Closed","dependencies":[{"issue_id":"option_returns-ba7","depends_on_id":"option_returns-i75","type":"blocks","created_at":"2025-12-21T21:42:30.019480042+01:00","created_by":"daemon"}]}
{"id":"option_returns-bec","title":"Remove unused covered_call fixture or add tests using it","description":"The covered_call fixture in tests/unit/test_risk.py is defined but never used.\n\nOptions:\n1. Remove the fixture if not needed (lines 50-68)\n2. Add test using it, e.g.:\n   - test_covered_call_max_gain_limited()\n   - test_covered_call_downside_protection()\n\nCovered call characteristics:\n- Long 100 shares at 100\n- Short call at strike 105\n- Premium collected: 200 (bid: 2.0 × 100)\n- Max gain: (105-100)*100 + 200 - 0.65 = 699.35\n- Max loss: Unlimited (stock can go to zero)\n\nRecommendation: Add test to validate capped upside behavior.\n\nSee: RISK_TESTS_REVIEW.md for suggestions","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-28T00:28:55.460644338+01:00","updated_at":"2025-12-28T00:28:55.460644338+01:00"}
{"id":"option_returns-beq","title":"Add PATCH /api/strategy/target-date endpoint","description":"Implement endpoint to update the target expiration date for an existing strategy session.\n\nRequirements:\n- PATCH /api/strategy/target-date endpoint\n- Accept target_date in request body (must be in available_expirations)\n- Validate target_date exists in strategy's available_expirations\n- Clear existing positions if target_date changes (or reject if positions exist)\n- Update session strategy data with new target_date\n- Return updated strategy info (similar to StrategyInitResponse)\n- Add appropriate error handling (invalid date, no session, etc.)\n- Add tests for endpoint\n\nSchema additions needed:\n- UpdateTargetDateRequest (target_date: str)\n- Response can reuse StrategyInitResponse or similar\n\nDecision needed: Should changing target_date clear positions, or should it be rejected if positions exist?","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T15:24:31.581039119+01:00","updated_at":"2026-01-02T17:58:27.283586071+01:00","closed_at":"2026-01-02T17:58:27.283586071+01:00","close_reason":"Closed","dependencies":[{"issue_id":"option_returns-beq","depends_on_id":"option_returns-dcz","type":"blocks","created_at":"2026-01-02T15:24:38.759495158+01:00","created_by":"kris"}]}
{"id":"option_returns-c9g","title":"Add input validation for symbol and month parameters","description":"Add Pydantic field validators: (1) Symbol: alphanumeric only, auto-uppercase; (2) Month: validate format matches pattern (e.g., JAN26, FEB26). Prevents malformed inputs from reaching IBKR API.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T22:55:43.136255621+01:00","updated_at":"2026-01-02T22:55:43.136255621+01:00"}
{"id":"option_returns-clo","title":"Add OptionChain Domain Model","description":"Add OptionChain model to domain.py with fields: symbol (str), expiration (date), calls (list[OptionContract]), puts (list[OptionContract]), optional underlying_price (float | None). Includes unit tests for the model.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-30T14:38:01.623606434+01:00","updated_at":"2025-12-30T14:43:44.831548573+01:00","closed_at":"2025-12-30T14:43:44.831548573+01:00","close_reason":"Closed"}
{"id":"option_returns-cn1","title":"Implement differentiated cache TTL strategy for option chain endpoints","description":"Currently all option chain endpoints use a uniform 15-minute cache TTL. Implement a differentiated strategy based on data volatility:\n\n- Contract metadata (get_unpriced_option_contract): 24 hours (very stable - conid, strike, expiration don't change)\n- Option strikes (get_option_strikes): 1 hour (relatively stable for a given month)\n- Market snapshot prices (get_market_snapshot in price_option_chain): 5 minutes (changes frequently)\n\nBenefits:\n- Better performance through longer caching of stable data\n- Fresher pricing data with shorter TTL\n- Reduced API calls overall\n\nImplementation:\n- Replace hardcoded timedelta(minutes=15) calls in get_unpriced_option_chain and price_option_chain\n- Use timedelta(hours=24) for contract metadata\n- Use timedelta(hours=1) for strikes\n- Use timedelta(minutes=5) for pricing snapshots\n\nSee code review discussion for option 4 details.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-31T14:15:33.881068873+01:00","updated_at":"2025-12-31T14:15:33.881068873+01:00"}
{"id":"option_returns-d6u","title":"Strategy Summary Endpoint","description":"Implement GET /api/strategy endpoint. Return current strategy from session without running analysis. Fast read operation.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T18:53:49.971448985+01:00","updated_at":"2026-01-02T16:38:40.766242394+01:00","closed_at":"2026-01-02T16:38:40.766242394+01:00","close_reason":"Closed","dependencies":[{"issue_id":"option_returns-d6u","depends_on_id":"option_returns-d95","type":"blocks","created_at":"2025-12-31T18:54:08.386858586+01:00","created_by":"daemon"},{"issue_id":"option_returns-d6u","depends_on_id":"option_returns-dmc","type":"blocks","created_at":"2025-12-31T18:54:08.409132402+01:00","created_by":"daemon"},{"issue_id":"option_returns-d6u","depends_on_id":"option_returns-qqe","type":"blocks","created_at":"2025-12-31T18:54:08.431129816+01:00","created_by":"daemon"}]}
{"id":"option_returns-d8l","title":"Add structured logging and basic observability","description":"Replace print statements with proper logging. Add: (1) Request/response logging with timing, (2) IBKR API call logging, (3) Session lifecycle events, (4) Error tracking with context. Use Python logging module with JSON formatter option.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T22:55:43.459247514+01:00","updated_at":"2026-01-02T22:55:43.459247514+01:00"}
{"id":"option_returns-d95","title":"Core API Infrastructure","description":"Build FastAPI app factory, error handling, schemas, dependency injection, CORS middleware, and health check endpoint. Foundation for all other API components.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-31T18:53:46.760267047+01:00","updated_at":"2026-01-01T01:52:19.772412212+01:00","closed_at":"2026-01-01T01:52:19.772412212+01:00","close_reason":"Closed"}
{"id":"option_returns-dcz","title":"Phase 4: API Layer","description":"FastAPI routes with session management\n\nTasks:\n- [ ] Session state service with cookie management\n- [ ] Session cleanup background task (every 5 min)\n- [ ] Automatic target date selection (earliest expiration)\n- [ ] Request validation (Pydantic schemas)\n- [ ] Standardized error responses\n- [ ] FastAPI routes with session dependency injection\n- [ ] Position modification endpoints (PATCH, DELETE)\n- [ ] Strategy summary endpoint\n- [ ] Change reset to POST (not DELETE)\n- [ ] API integration tests with validation checks\n\nDeliverables:\n- All REST endpoints implemented\n- Session management with cookies\n- Validation and error handling\n- Auto-documentation at /docs\n\nSuccess Criteria:\n- Sessions persist across requests\n- Mixed expiration rejected with MIXED_EXPIRATION error\n- Auto target date selection works\n- All endpoints return standardized errors","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-19T21:53:22.714365181+01:00","updated_at":"2026-01-02T23:37:12.880419008+01:00","closed_at":"2026-01-02T23:37:12.880419008+01:00","close_reason":"Phase 4 API Layer complete. All 10 tasks implemented:\n- Session state service with cookie management ✓\n- Session cleanup background task (every 5 min) ✓\n- Automatic target date selection ✓\n- Request validation with Pydantic schemas ✓\n- Standardized error responses ✓\n- FastAPI routes with session dependency injection ✓\n- Position modification endpoints (PATCH, DELETE) ✓\n- Strategy summary endpoint ✓\n- Reset endpoint (POST /api/strategy/reset) ✓\n- API integration tests (51 unit + 14 integration) ✓\n\nAll deliverables met: REST endpoints, session management, validation, error handling, auto-docs at /docs. All success criteria achieved.","dependencies":[{"issue_id":"option_returns-dcz","depends_on_id":"option_returns-g9y","type":"blocks","created_at":"2026-01-02T23:34:14.000030516+01:00","created_by":"kris"}]}
{"id":"option_returns-dia","title":"Modernize deprecated type hints to Python 3.11+ syntax","description":"Update deprecated typing imports and type hints to modern Python 3.11+ syntax.\n\nCurrent violations (8 total):\n- UP035: typing.List is deprecated, use list instead\n- UP006: Use list instead of List for type annotations\n- UP045: Use X | None instead of Optional[X]\n\nFiles affected:\n- src/option_analyzer/models/domain.py (lines 12, 33, 66-67, 90, 183, 235)\n- src/option_analyzer/config.py (line 38)\n\nChanges needed:\n- List[date] → list[date]\n- Optional[float] → float | None\n- Optional[date] → date | None\n- List[OptionPosition] → list[OptionPosition]\n\nSolution: Run 'ruff check --fix' to auto-fix all violations (~2 minutes work).\n\nThis should be done before Phase 2 to maintain modern Python standards.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T09:26:51.761246547+01:00","updated_at":"2025-12-21T16:10:22.348925618+01:00","closed_at":"2025-12-21T16:10:22.348925618+01:00","close_reason":"Closed"}
{"id":"option_returns-dmc","title":"Session Management Service","description":"Implement SessionState model, SessionService class, cookie-based session IDs, TTL expiration, and background cleanup task (every 5 min). Foundation for stateful endpoints.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-31T18:53:47.312555822+01:00","updated_at":"2026-01-01T21:41:34.86099701+01:00","closed_at":"2026-01-01T21:41:34.86099701+01:00","close_reason":"Closed","dependencies":[{"issue_id":"option_returns-dmc","depends_on_id":"option_returns-d95","type":"blocks","created_at":"2025-12-31T18:54:05.791440355+01:00","created_by":"daemon"}]}
{"id":"option_returns-dmu","title":"Add IBKR Custom Exceptions","description":"Add 6 new exceptions to src/option_analyzer/utils/exceptions.py: IBKRAPIError, IBKRConnectionError, RateLimitExceededError, SymbolNotFoundError, InsufficientDataError, AmbiguousSymbolError","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:50:51.052583979+01:00","updated_at":"2025-12-23T15:29:49.316368046+01:00","closed_at":"2025-12-23T15:29:49.316368046+01:00","close_reason":"Closed"}
{"id":"option_returns-dse","title":"Position Management Endpoints","description":"Implement POST /positions (add), PATCH /positions/{conid} (modify), DELETE /positions/{conid} (remove). Validate quantity != 0, check mixed expirations.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-31T18:53:48.902503435+01:00","updated_at":"2026-01-01T22:18:57.855668047+01:00","closed_at":"2026-01-01T22:18:57.855668047+01:00","close_reason":"Closed","dependencies":[{"issue_id":"option_returns-dse","depends_on_id":"option_returns-d95","type":"blocks","created_at":"2025-12-31T18:54:07.281893647+01:00","created_by":"daemon"},{"issue_id":"option_returns-dse","depends_on_id":"option_returns-dmc","type":"blocks","created_at":"2025-12-31T18:54:07.302541615+01:00","created_by":"daemon"},{"issue_id":"option_returns-dse","depends_on_id":"option_returns-qqe","type":"blocks","created_at":"2025-12-31T18:54:07.32389324+01:00","created_by":"daemon"}]}
{"id":"option_returns-dtp","title":"Fix deprecated datetime.utcnow() calls","description":"session.py uses datetime.utcnow() which is deprecated in Python 3.12+.\n\nLocations:\n- session.py:27 (SessionState.created_at default)\n- session.py:29 (SessionState.last_accessed default)\n- session.py:46 (is_expired calculation)\n- session.py:51 (touch() update)\n- session.py:98 (cleanup_expired_sessions)\n\nChange:\n# Before\ndatetime.utcnow()\n\n# After\nfrom datetime import UTC\ndatetime.now(UTC)\n\nImpact: Future Python compatibility\nFiles: src/option_analyzer/models/session.py, src/option_analyzer/services/session.py\n\nTesting: Verify timezone-aware datetime objects","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-01T22:18:10.93458846+01:00","updated_at":"2026-01-02T23:19:54.657111657+01:00","closed_at":"2026-01-02T23:19:54.657111657+01:00","close_reason":"Closed"}
{"id":"option_returns-eav","title":"Performance tests and benchmarks (\u003c5s for 10k simulations)","description":"Performance validation and benchmarking for bootstrap simulation.\n\nDeliverables:\n- tests/performance/test_bootstrap.py (~50 lines)\n- Performance test results documentation\n\nPerformance Tests:\n- test_10k_simulations_under_5_seconds()\n  - 10,000 Monte Carlo simulations with 50 steps\n  - Assert completion in \u003c5 seconds\n  - Verify correct output shape\n  \n- test_vectorization_speedup()\n  - Compare vectorized vs loop implementation\n  - Document speedup factor\n  \n- test_large_dataset_binning()\n  - 100,000 values into 100 bins\n  - Assert completion in \u003c1 second\n\nSuccess Criteria:\n- All performance targets met\n- Vectorization confirmed working\n- Results documented for future regression testing\n\nNotes:\n- Use time.time() for timing\n- Run multiple iterations for stability\n- Document hardware specs in results","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T21:42:23.153528928+01:00","updated_at":"2025-12-24T01:26:20.235355754+01:00","closed_at":"2025-12-24T01:26:20.235355754+01:00","close_reason":"Implemented performance tests with all 4 tests passing:\n- test_10k_simulations_under_5_seconds: Validates 10k Monte Carlo simulations complete in \u003c5s\n- test_vectorization_speedup: Confirms vectorization provides 2x+ speedup vs loops  \n- test_large_dataset_binning: Verifies 100k values bin into 100 bins in \u003c1s\n- test_monte_carlo_scalability: Bonus test confirming linear scaling\n\nAll tests pass and meet performance targets. Code includes comprehensive docstrings and realistic test scenarios.","dependencies":[{"issue_id":"option_returns-eav","depends_on_id":"option_returns-i75","type":"blocks","created_at":"2025-12-21T21:42:30.105531869+01:00","created_by":"daemon"}]}
{"id":"option_returns-eiu","title":"Implement Risk Metrics Module (EV, PoP)","description":"Risk metrics calculation with Strategy integration.\n\nDeliverables:\n- src/option_analyzer/services/risk.py (~150 lines)\n- RiskMetrics Pydantic model (EV, PoP, max_gain, max_loss, breakevens)\n- calculate_expected_value() - probability-weighted P\u0026L\n- calculate_probability_of_profit() - fraction with P\u0026L \u003e 0\n- calculate_risk_metrics() - main entry point with validation\n\nTechnical Requirements:\n- Calls strategy.validate_for_analysis() before expensive calculations\n- Uses strategy.total_payoff(bin.midpoint) for P\u0026L evaluation\n- Weights by bin.count / total_count for probabilities\n- Comprehensive docstrings and type hints\n\nIntegration:\n- Depends on Statistics Module for PriceBin\n- Integrates with Strategy from domain.py\n- Uses transaction costs from config","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T21:40:44.003622384+01:00","updated_at":"2025-12-27T17:14:33.020861549+01:00","closed_at":"2025-12-27T17:14:33.020861549+01:00","close_reason":"Closed","dependencies":[{"issue_id":"option_returns-eiu","depends_on_id":"option_returns-i75","type":"blocks","created_at":"2025-12-21T21:42:29.975928721+01:00","created_by":"daemon"}]}
{"id":"option_returns-ept","title":"Add IBKR Configuration Settings","description":"Add missing config fields to Settings class: ibkr_verify_ssl, ibkr_max_retries, ibkr_retry_delay. Update default_historical_years if needed.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:50:50.371361085+01:00","updated_at":"2025-12-23T14:57:28.697073951+01:00","closed_at":"2025-12-23T14:57:28.697073951+01:00","close_reason":"Closed"}
{"id":"option_returns-f1q","title":"Validate trading days assumption (252/365 vs actual calendar)","description":"Current plan uses 252/365 ratio for trading day adjustments, which is a simplification that doesn't account for actual market holidays or different exchange calendars.\n\nInvestigation needed:\n- Measure error accumulation over typical analysis periods (30d, 60d, 1y)\n- Evaluate if precision is acceptable for expected use cases\n- Consider alternatives: actual trading day counts, exchange-specific calendars\n- Document decision rationale\n\nDecision criteria:\n- Is the error \u003c1% for typical periods?\n- Do we need exchange-specific calendars?\n- Does simplicity outweigh precision for MVP?\n\nFiles: src/option_analyzer/services/statistics.py (calculate_period_for_days)\nRelated: Phase 2 Statistical Engine","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T21:55:06.79737231+01:00","updated_at":"2025-12-21T21:55:06.79737231+01:00"}
{"id":"option_returns-fbq","title":"Fix null bid/ask in option chain - implement IBKR pre-flight retry","description":"## Problem\nOption chain endpoint returns null bid/ask for all contracts despite IBKR portal running.\n\n## Root Cause\nIBKR Client Portal API requires a 'pre-flight' request to initialize market data streams. The first snapshot request doesn't return bid/ask data (fields 84/86), but subsequent requests do.\n\nCurrent code in `get_market_snapshot()` (ibkr.py:140) makes a single request and caches the result, so null values persist.\n\n## Solution\nImplement retry logic in `get_market_snapshot()`:\n1. Check if all bid/ask values are null after first request\n2. If so, wait 0.5s and retry (bypass cache)\n3. Cache the successful response\n\n## Implementation Notes\n- Add check: `all(d.get(\"bid\") is None and d.get(\"ask\") is None for d in parsed_data)`\n- Add `await asyncio.sleep(0.5)` before retry\n- Move cache.set() to after retry logic\n- Add debug logging for pre-flight detection\n\n## References\n- IBKR docs: Pre-flight requests initialize data streams\n- Affects: src/option_analyzer/clients/ibkr.py:140-155\n- Related endpoint: /stocks/{symbol}/chain","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-02T12:56:19.227598143+01:00","updated_at":"2026-01-02T12:56:19.227598143+01:00"}
{"id":"option_returns-g9y","title":"Add POST /api/strategy/reset endpoint","description":"Implement POST /api/strategy/reset endpoint to clear strategy state.\n\nRequirements:\n- Clear all positions from current strategy\n- Optionally reset target date to earliest expiration\n- Keep same session (don't create new session)\n- Return empty strategy summary\n- Add tests for reset endpoint\n\nPart of Phase 4 API Layer (option_returns-dcz) completion.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T23:34:00.095699352+01:00","updated_at":"2026-01-02T23:36:32.535452554+01:00","closed_at":"2026-01-02T23:36:32.535452554+01:00","close_reason":"Implemented POST /api/strategy/reset endpoint with comprehensive test coverage (5 unit tests)"}
{"id":"option_returns-gd3","title":"End-to-End Error Handling Tests","description":"Test all error conditions across endpoints. Verify retry logic with network failures. Verify rate limiting prevents bans. Test cache behavior under error conditions. Comprehensive unhappy path coverage.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:51:34.698794289+01:00","updated_at":"2025-12-31T18:13:16.584923538+01:00","closed_at":"2025-12-31T18:13:16.584923538+01:00","close_reason":"Closed","dependencies":[{"issue_id":"option_returns-gd3","depends_on_id":"option_returns-7xh","type":"blocks","created_at":"2025-12-21T21:51:41.014937849+01:00","created_by":"daemon"},{"issue_id":"option_returns-gd3","depends_on_id":"option_returns-tbp","type":"blocks","created_at":"2025-12-21T21:51:41.050650422+01:00","created_by":"daemon"},{"issue_id":"option_returns-gd3","depends_on_id":"option_returns-b96","type":"blocks","created_at":"2025-12-21T21:51:41.090499614+01:00","created_by":"daemon"},{"issue_id":"option_returns-gd3","depends_on_id":"option_returns-6ik","type":"blocks","created_at":"2025-12-21T21:51:41.126291918+01:00","created_by":"daemon"}]}
{"id":"option_returns-gk1","title":"Phase 5: Visualization","description":"Strategy plot generation with matplotlib\n\nTasks:\n- [ ] Matplotlib chart generation (async with thread pool)\n- [ ] Per-session plot file naming\n- [ ] Plot directory creation and cleanup\n- [ ] Plot caching\n- [ ] Visual regression tests\n\nDeliverables:\n- Dual-axis chart (histogram + P\u0026L curve)\n- Session-isolated plot files\n- Async rendering (non-blocking)\n\nSuccess Criteria:\n- Plot generation doesn't block requests\n- Plots saved as /static/plots/{session_id}_{timestamp}.png\n- Old plots cleaned up with sessions","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-19T21:53:23.098098833+01:00","updated_at":"2025-12-19T21:53:23.098098833+01:00","dependencies":[{"issue_id":"option_returns-gk1","depends_on_id":"option_returns-dcz","type":"blocks","created_at":"2025-12-19T21:54:21.064077655+01:00","created_by":"daemon"}]}
{"id":"option_returns-gwz","title":"Refactor RateLimiter.acquire() to reduce cyclomatic complexity","description":"The acquire() method in rate_limiter.py has cyclomatic complexity of 7 due to duplicated cleanup logic.\n\nCurrent issues:\n- Cleanup logic repeated at lines 52-53 and 62-63\n- Nested while loops make testing edge cases harder\n- Difficult to maintain for future developers\n\nSolution: Extract cleanup as private _cleanup_expired_requests() method to eliminate duplication and reduce complexity.\n\nFile: src/option_analyzer/utils/rate_limiter.py:39-66","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T09:22:09.152376727+01:00","updated_at":"2025-12-21T16:19:28.151106582+01:00","closed_at":"2025-12-21T16:19:28.151106582+01:00","close_reason":"Closed"}
{"id":"option_returns-h04","title":"Raise MissingBidAskError when option price data is unavailable","description":"Currently OptionPosition.premium_paid defaults to 0.0 when bid/ask is None. This can lead to incorrect P\u0026L calculations. Update to raise MissingBidAskError instead to catch missing price data early.\n\nLocation: src/option_analyzer/models/domain.py:143-148\n\nChanges needed:\n- Update premium_paid property to validate bid/ask is not None\n- Raise MissingBidAskError with helpful message indicating which contract\n- Update tests to verify error is raised\n- Consider adding a has_price_data() helper method\n\nImpact: Prevents silent failures in analysis when price data is missing","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:12:42.041132593+01:00","updated_at":"2025-12-21T21:18:54.319050628+01:00","closed_at":"2025-12-21T21:18:54.319050628+01:00","close_reason":"Closed"}
{"id":"option_returns-h17","title":"Document expected IBKR API output formats","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T13:38:10.160743304+01:00","updated_at":"2025-12-31T13:38:10.160743304+01:00"}
{"id":"option_returns-h1t","title":"Add endpoint rate limiting middleware","description":"API endpoints have no rate limiting, exposing DoS vulnerability. IBKR client has rate limiting but endpoints don't.\n\nImplementation:\n- Create RateLimitMiddleware in api/middleware.py\n- Use existing RateLimiter from utils/rate_limiter.py\n- Apply per-IP rate limiting (e.g., 100 req/min per IP)\n- Return 429 Too Many Requests with Retry-After header\n- Configurable limits via Settings\n- Exempt /health endpoint\n\nFiles:\n- src/option_analyzer/api/middleware.py (add RateLimitMiddleware)\n- src/option_analyzer/config.py (add rate limit settings)\n- src/option_analyzer/api/app.py (register middleware)\n- tests/unit/test_middleware.py (create new)\n\nTesting: Verify 429 returned after limit, verify reset after window","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-01T22:18:11.68655872+01:00","updated_at":"2026-01-01T22:18:11.68655872+01:00"}
{"id":"option_returns-i75","title":"Implement Statistics Module (geometric returns, bootstrap, histogram)","description":"Core statistical functions for price distribution modeling.\n\nDeliverables:\n- src/option_analyzer/services/statistics.py (~350 lines)\n- PriceBin Pydantic model with midpoint/width properties\n- geometric_returns() - calculate price multipliers\n- calculate_period_for_days() - trading day adjustment\n- bootstrap_walk() - single random walk\n- monte_carlo_simulation() - vectorized bootstrap (10k samples \u003c5s)\n- get_price_distribution() - direct + Monte Carlo modes\n- calculate_price_range() - auto with 5% padding + user override\n- create_histogram() - with max value edge case handling\n\nTechnical Requirements:\n- NumPy vectorization for performance\n- Comprehensive docstrings with Args/Returns/Raises/Examples\n- Type hints (Python 3.11+ syntax)\n- Input validation with clear error messages\n\nReferences:\n- Plan file: /var/home/kris/.claude/plans/purring-sparking-cookie.md\n- Integration: src/option_analyzer/models/domain.py","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T21:40:35.763673159+01:00","updated_at":"2025-12-21T22:00:33.049752525+01:00","closed_at":"2025-12-21T22:00:33.049752525+01:00","close_reason":"Implemented Statistics Module with all required components:\n- PriceBin Pydantic model with midpoint/width properties\n- geometric_returns() for price multiplier calculation\n- calculate_period_for_days() with trading day adjustment\n- bootstrap_walk() for single random walk simulation\n- monte_carlo_simulation() with vectorized NumPy (10k sims in 0.007s - way under 5s target!)\n- get_price_distribution() supporting both direct and Monte Carlo modes\n- calculate_price_range() with automatic 5% padding and user overrides\n- create_histogram() with proper max value edge case handling\n\nAll functions include comprehensive docstrings, Python 3.11+ type hints, input validation, and use NumPy vectorization for performance. Code passes ruff checks and integrates cleanly with existing test suite."}
{"id":"option_returns-iol","title":"Phase 6: Frontend","description":"Web UI with vanilla JavaScript\n\nTasks:\n- [ ] HTML/CSS structure\n- [ ] Loading state UI (spinners, disabled buttons)\n- [ ] Error display component\n- [ ] Modular JavaScript with state management\n- [ ] Position modification UI (edit, delete)\n- [ ] Strategy summary display\n- [ ] Analysis parameters controls (historical years, price range)\n- [ ] Event handling\n- [ ] Playwright E2E tests\n\nDeliverables:\n- Responsive web interface\n- Loading states for all operations\n- Position management UI\n- E2E test suite\n\nSuccess Criteria:\n- Mobile-responsive design\n- Loading states prevent user confusion\n- Errors display with clear messages\n- E2E tests cover critical user flows","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-19T21:53:23.479622932+01:00","updated_at":"2025-12-19T21:53:23.479622932+01:00","dependencies":[{"issue_id":"option_returns-iol","depends_on_id":"option_returns-gk1","type":"blocks","created_at":"2025-12-19T21:54:21.108735622+01:00","created_by":"daemon"}]}
{"id":"option_returns-jcq","title":"Implement Cache Interface and In-Memory Cache","description":"Create CacheInterface protocol in src/option_analyzer/clients/cache.py. Implement InMemoryCache with TTL support. Unit tests for cache behavior (set, get, expiration).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:50:50.717707001+01:00","updated_at":"2025-12-23T15:10:09.503828968+01:00","closed_at":"2025-12-23T15:10:09.503828968+01:00","close_reason":"Closed"}
{"id":"option_returns-k5z","title":"Integration Tests with Real IBKR (Optional)","description":"Real API tests marked with @pytest.mark.integration. Requires running IBKR Client Portal. Skip by default (pytest -m 'not integration'). Tests all endpoints with real API calls.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T21:51:34.36387961+01:00","updated_at":"2025-12-21T21:51:34.36387961+01:00","dependencies":[{"issue_id":"option_returns-k5z","depends_on_id":"option_returns-7xh","type":"blocks","created_at":"2025-12-21T21:51:40.580210385+01:00","created_by":"daemon"},{"issue_id":"option_returns-k5z","depends_on_id":"option_returns-tbp","type":"blocks","created_at":"2025-12-21T21:51:40.619117607+01:00","created_by":"daemon"},{"issue_id":"option_returns-k5z","depends_on_id":"option_returns-b96","type":"blocks","created_at":"2025-12-21T21:51:40.654815513+01:00","created_by":"daemon"},{"issue_id":"option_returns-k5z","depends_on_id":"option_returns-6ik","type":"blocks","created_at":"2025-12-21T21:51:40.690557371+01:00","created_by":"daemon"}]}
{"id":"option_returns-l3b","title":"Decouple domain models from IBKR-specific conids","description":"## Problem\n\nDomain models (Stock, OptionContract) contain IBKR-specific conids, which hurts modularity but provides performance benefits through caching.\n\n## Current Implementation\n- Stock.conid: IBKR contract ID for underlying\n- OptionContract.conid: IBKR contract ID for option\n- Conids used throughout for API caching, pricing lookups, batching\n\n## Architectural Options\n\n### 1. Accept the Coupling (Pragmatic)\nRename to ibkr_conid to make dependency explicit. Simplest if only using IBKR.\n\n### 2. Adapter Pattern (Clean Architecture)\nRemove conids from domain models, maintain IBKRContractRegistry mapping layer. Best for multi-broker support.\n\n### 3. Provider Metadata Pattern\nAdd provider_metadata dict field for broker-specific data. Flexible but loses type safety.\n\n### 4. Two-Layer Model\nSeparate pure domain models from broker-enriched models (IBKRStock extends Stock).\n\n### 5. Value Object Wrapper\nMake ConId a distinct type to make coupling explicit at type level.\n\n## Recommendation\nIf supporting multiple brokers: Option 2 (Adapter Pattern)\nIf IBKR-only: Option 1 (rename) or Option 5 (value object)\n\n## References\n- Conids used in: src/option_analyzer/models/domain.py:24,53\n- IBKR client: src/option_analyzer/clients/ibkr.py\n- Recent separation work: commit 4bdec4b (construct/price steps)","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-31T15:17:06.064210587+01:00","updated_at":"2025-12-31T15:17:06.064210587+01:00"}
{"id":"option_returns-lmj","title":"Define histogram epsilon strategy for max value inclusion","description":"Histogram binning needs to ensure maximum values are included in the last bin, but the epsilon strategy is not specified in the plan.\n\nOptions to evaluate:\n1. Fixed epsilon: upper = max_value + 1e-10\n2. Relative epsilon: upper = max_value * 1.000001\n3. NumPy nextafter: upper = np.nextafter(max_value, np.inf)\n4. Inclusive comparison: last bin uses \u003c= instead of \u003c\n\nTrade-offs:\n- Numerical precision at extreme values\n- Readability and maintainability\n- Edge cases (very large/small values)\n- Performance implications\n\nDecision needed before finalizing create_histogram() implementation.\n\nFiles: src/option_analyzer/services/statistics.py (create_histogram)\nRelated: Phase 2 Statistical Engine","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T21:55:07.145596813+01:00","updated_at":"2025-12-21T21:55:07.145596813+01:00"}
{"id":"option_returns-lvz","title":"Fix URL encoding in symbol lookup endpoint","description":"Symbol and asset_type parameters in get_search_results() are concatenated directly into URL without encoding (ibkr.py:107). Symbols like 'BRK.B' or 'AT\u0026T' will break. Should use httpx params parameter or urllib.parse.urlencode(). Also add tests for special characters.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-28T19:31:16.837468939+01:00","updated_at":"2025-12-28T19:31:16.837468939+01:00"}
{"id":"option_returns-m3z","title":"Fix flaky performance test: test_monte_carlo_scalability","description":"The test_monte_carlo_scalability test in tests/performance/test_bootstrap.py is flaky because the implementation is too fast (1.31x scaling vs expected 1.5-3x).\n\nIssue: Test expects 10k simulations to take 1.5-3x longer than 5k simulations, but actual performance is better than expected due to NumPy/BLAS optimizations.\n\nError:\nAssertionError: Non-linear scaling detected: 1.31x\nassert 1.5 \u003c 1.3082012617325742\n\nOptions to fix:\n1. Adjust test tolerance to 1.0 \u003c scaling_ratio \u003c 3.0 (allows superlinear speedup)\n2. Remove the test entirely (primary \u003c5s target is already validated)\n3. Investigate and document the optimization cause\n\nLocation: tests/performance/test_bootstrap.py:152\n\nImpact: Breaks CI/CD but not a code quality issue - performance is better than expected.","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-28T00:39:12.642509217+01:00","updated_at":"2025-12-28T00:39:12.642509217+01:00"}
{"id":"option_returns-msp","title":"Add comprehensive tests for API endpoints","description":"Zero test coverage for API routes (strategy.py, stocks.py, health.py). Need tests for:\n\nUnit tests (tests/unit/test_api_endpoints.py):\n- test_strategy_init_success() - verify session creation and response\n- test_strategy_init_no_expirations() - verify ValidationError raised\n- test_strategy_init_creates_session() - verify session in service\n- test_get_stock() - verify StockResponse format\n- test_get_option_chain() - verify OptionChainResponse format\n- test_health_check() - verify response format\n\nIntegration tests (tests/integration/test_api_workflow.py):\n- test_full_strategy_workflow() - init -\u003e get chain -\u003e add position\n- test_session_persistence_across_requests() - verify cookie works\n- test_session_expiration() - verify 401 after TTL\n\nFiles:\n- tests/unit/test_api_endpoints.py (create new)\n- tests/integration/test_api_workflow.py (create new)\n- src/option_analyzer/api/routes/*.py (0% coverage)\n\nBlocker for Phase 5.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-01T22:18:10.220729276+01:00","updated_at":"2026-01-01T22:26:58.421267118+01:00","closed_at":"2026-01-01T22:26:58.421267118+01:00","close_reason":"Closed"}
{"id":"option_returns-myc","title":"Implement chunked historical data requests for periods \u003e3 years","description":"IBKR historical data endpoint has 1000 data point limit (~252 trading days/year = max 3-4 years per request).\n\nCurrent: get_historical_data() accepts years parameter but doesn't chunk for periods \u003e3 years.\n\nImplementation:\n- Calculate chunks needed (e.g., 5 years → 2y + 2y + 1y)\n- Make sequential API calls respecting rate limits\n- Merge results, deduplicate overlapping dates\n- Cache merged result with 24h TTL\n\nTesting: 4-5 year requests, 10 year requests, overlap handling, cache behavior\n\nQuestions:\n- Does IBKR support starttime parameter?\n- Optimal chunk size (fixed 3y vs dynamic)?\n- Handle partial failures?\n\nFile: src/option_analyzer/clients/ibkr.py:287 (comment marks location)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T17:19:44.049706019+01:00","updated_at":"2025-12-31T17:19:44.049706019+01:00","dependencies":[{"issue_id":"option_returns-myc","depends_on_id":"option_returns-6ik","type":"blocks","created_at":"2025-12-31T17:19:55.499947582+01:00","created_by":"daemon"}]}
{"id":"option_returns-nma","title":"Fix duplicate position handling in POST /api/strategy/positions","description":"Currently allows adding same conid multiple times. Need to decide behavior: (A) upsert existing position, (B) return error, or (C) sum quantities. Recommendation: Return error with clear message.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-02T22:55:42.816750883+01:00","updated_at":"2026-01-02T23:08:58.568925443+01:00","closed_at":"2026-01-02T23:08:58.568925443+01:00","close_reason":"Closed"}
{"id":"option_returns-ouf","title":"Implement IBKRClient Base with Retry Logic","description":"Create src/option_analyzer/clients/ibkr.py with HTTPX client setup (base URL, timeout, SSL config). Integrate RateLimiter from Phase 1. Implement exponential backoff retry logic (1s-\u003e2s-\u003e4s, max 3 retries). Error response parsing and exception mapping.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T21:50:57.574629763+01:00","updated_at":"2025-12-28T01:00:45.57097192+01:00","closed_at":"2025-12-28T01:00:45.57097192+01:00","close_reason":"Closed","dependencies":[{"issue_id":"option_returns-ouf","depends_on_id":"option_returns-ept","type":"blocks","created_at":"2025-12-21T21:51:03.685011156+01:00","created_by":"daemon"},{"issue_id":"option_returns-ouf","depends_on_id":"option_returns-jcq","type":"blocks","created_at":"2025-12-21T21:51:03.722704133+01:00","created_by":"daemon"},{"issue_id":"option_returns-ouf","depends_on_id":"option_returns-dmu","type":"blocks","created_at":"2025-12-21T21:51:03.760869803+01:00","created_by":"daemon"}]}
{"id":"option_returns-ps2","title":"Fix linting issues (7 found, 6 auto-fixable)","description":"Run 'ruff check --fix src/option_analyzer' to auto-fix 6 issues (import sorting, deprecated TimeoutError, unused imports/vars, whitespace). Manually fix unused 'now' variable in session.py:98.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T22:55:57.275880624+01:00","updated_at":"2026-01-02T22:55:57.275880624+01:00"}
{"id":"option_returns-qav","title":"Make symbol lookup cache TTL configurable","description":"get_conid() hardcodes 24h TTL (ibkr.py:122). Should be configurable via Settings for different environments (prod=24h, test=1m, etc.). Makes testing easier and more flexible.","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-28T19:31:17.160174265+01:00","updated_at":"2025-12-28T19:31:17.160174265+01:00"}
{"id":"option_returns-qqe","title":"Strategy Initialization Endpoint","description":"Implement POST /api/strategy/init endpoint. Initialize strategy with stock, automatically select target_date (earliest expiration), store in session.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-31T18:53:48.36731729+01:00","updated_at":"2026-01-01T22:10:07.579477671+01:00","closed_at":"2026-01-01T22:10:07.579477671+01:00","close_reason":"Closed","dependencies":[{"issue_id":"option_returns-qqe","depends_on_id":"option_returns-d95","type":"blocks","created_at":"2025-12-31T18:54:06.775644228+01:00","created_by":"daemon"},{"issue_id":"option_returns-qqe","depends_on_id":"option_returns-dmc","type":"blocks","created_at":"2025-12-31T18:54:06.797891252+01:00","created_by":"daemon"}]}
{"id":"option_returns-sqh","title":"Implement position management endpoints","description":"Phase 4 requirement: Position modification endpoints (PATCH, DELETE) not implemented.\n\nRequired endpoints:\n- POST /api/strategy/positions - Add position to strategy\n- PATCH /api/strategy/positions/{position_id} - Update quantity\n- DELETE /api/strategy/positions/{position_id} - Remove position\n- GET /api/strategy/positions - List current positions\n\nRequirements:\n- Validate position data (contract, quantity)\n- Store in session.data['strategy']['positions']\n- Return updated position list\n- Handle session expiration (401)\n- Validate contracts exist in IBKR\n\nFiles:\n- src/option_analyzer/api/routes/strategy.py (add endpoints)\n- src/option_analyzer/api/schemas.py (add PositionRequest/Response)\n- tests/unit/test_api_endpoints.py (add tests)\n\nDepends on: Session tests (for confidence in session state)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T22:18:11.313544222+01:00","updated_at":"2026-01-02T15:55:45.744933557+01:00","closed_at":"2026-01-02T15:55:45.744933557+01:00","close_reason":"Implemented comprehensive tests for all three position management endpoints (POST, PATCH, DELETE). All 28 tests pass.","dependencies":[{"issue_id":"option_returns-sqh","depends_on_id":"option_returns-8l8","type":"blocks","created_at":"2026-01-01T22:18:19.67683303+01:00","created_by":"kris"},{"issue_id":"option_returns-sqh","depends_on_id":"option_returns-msp","type":"blocks","created_at":"2026-01-01T22:18:19.989428515+01:00","created_by":"kris"}]}
{"id":"option_returns-swf","title":"Implement validation for IBKR API output","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T13:38:10.534534851+01:00","updated_at":"2025-12-31T13:38:10.534534851+01:00","dependencies":[{"issue_id":"option_returns-swf","depends_on_id":"option_returns-h17","type":"blocks","created_at":"2025-12-31T13:38:15.118309098+01:00","created_by":"daemon"}]}
{"id":"option_returns-tbp","title":"Implement Stock Quote Endpoint","description":"Implement get_stock(symbol: str) -\u003e Stock method in IBKRClient. Uses search+snapshot endpoints (iserver/secdef/search + iserver/marketdata/snapshot). Returns Phase 1 Stock model. Cache integration with 5min TTL. Mock-based unit tests.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:51:15.75512055+01:00","updated_at":"2025-12-28T20:42:21.854528718+01:00","closed_at":"2025-12-28T20:42:21.854528718+01:00","close_reason":"Closed","dependencies":[{"issue_id":"option_returns-tbp","depends_on_id":"option_returns-ouf","type":"blocks","created_at":"2025-12-21T21:51:24.951717417+01:00","created_by":"daemon"},{"issue_id":"option_returns-tbp","depends_on_id":"option_returns-7xh","type":"blocks","created_at":"2025-12-21T21:51:24.987257303+01:00","created_by":"daemon"}]}
{"id":"option_returns-tgg","title":"Phase 3: IBKR Integration","description":"Interactive Brokers API client with rate limiting\n\nTasks:\n- [ ] HTTPX client with rate limiting\n- [ ] Retry logic with exponential backoff\n- [ ] Cache layer\n- [ ] Stock/chain/history endpoints (configurable years)\n- [ ] Error handling (IBKR down, symbol not found, rate limited)\n- [ ] Mock-based integration tests\n- [ ] Optional: Real IBKR integration tests\n\nDeliverables:\n- IBKRClient with rate limiting (50 req/60s)\n- Retry logic with exponential backoff\n- Cache interface with in-memory implementation\n- Comprehensive error handling\n\nSuccess Criteria:\n- Rate limiting prevents IBKR bans\n- Retries handle transient failures\n- Cache reduces redundant API calls","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-19T21:53:32.871650723+01:00","updated_at":"2025-12-31T18:37:09.437797872+01:00","closed_at":"2025-12-31T18:37:09.437797872+01:00","close_reason":"Phase 3 IBKR integration complete. All core endpoints implemented (symbol lookup, stock quote, option chain, historical data). Comprehensive test coverage with 2442 lines of tests. Known limitations tracked in separate issues. See code review for detailed assessment.","dependencies":[{"issue_id":"option_returns-tgg","depends_on_id":"option_returns-ept","type":"blocks","created_at":"2025-12-21T21:51:46.499016456+01:00","created_by":"daemon"},{"issue_id":"option_returns-tgg","depends_on_id":"option_returns-jcq","type":"blocks","created_at":"2025-12-21T21:51:46.538582774+01:00","created_by":"daemon"},{"issue_id":"option_returns-tgg","depends_on_id":"option_returns-dmu","type":"blocks","created_at":"2025-12-21T21:51:46.575770185+01:00","created_by":"daemon"},{"issue_id":"option_returns-tgg","depends_on_id":"option_returns-ouf","type":"blocks","created_at":"2025-12-21T21:51:46.608143256+01:00","created_by":"daemon"},{"issue_id":"option_returns-tgg","depends_on_id":"option_returns-7xh","type":"blocks","created_at":"2025-12-21T21:51:46.64266624+01:00","created_by":"daemon"},{"issue_id":"option_returns-tgg","depends_on_id":"option_returns-tbp","type":"blocks","created_at":"2025-12-21T21:51:46.680152075+01:00","created_by":"daemon"},{"issue_id":"option_returns-tgg","depends_on_id":"option_returns-b96","type":"blocks","created_at":"2025-12-21T21:51:46.716036874+01:00","created_by":"daemon"},{"issue_id":"option_returns-tgg","depends_on_id":"option_returns-6ik","type":"blocks","created_at":"2025-12-21T21:51:46.75486191+01:00","created_by":"daemon"},{"issue_id":"option_returns-tgg","depends_on_id":"option_returns-gd3","type":"blocks","created_at":"2025-12-21T21:51:46.792694882+01:00","created_by":"daemon"}]}
{"id":"option_returns-tle","title":"Implement endpoint-specific rate limiting","description":"Implement weighted token acquisition for RateLimiter to handle IBKR's endpoint-specific rate limits. See RATE_LIMITING_PLAN.md for detailed implementation plan. Key changes: enhance RateLimiter.acquire() with tokens parameter, update IBKRClient to calculate and pass token weights for snapshot batching, add semaphore for history endpoint concurrency limits. Also fixes batching bug in price_option_chain() line 252.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T13:16:52.394939137+01:00","updated_at":"2025-12-31T13:16:52.394939137+01:00"}
{"id":"option_returns-u43","title":"Stock and Option Chain Endpoints","description":"Implement GET /api/stocks/{symbol} and GET /api/stocks/{symbol}/chains endpoints. Stateless market data retrieval from IBKR with caching.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-31T18:53:47.833307293+01:00","updated_at":"2026-01-01T21:44:37.861664186+01:00","closed_at":"2026-01-01T21:44:37.861664186+01:00","close_reason":"Closed","dependencies":[{"issue_id":"option_returns-u43","depends_on_id":"option_returns-d95","type":"blocks","created_at":"2025-12-31T18:54:06.279451323+01:00","created_by":"daemon"}]}
{"id":"option_returns-ukg","title":"Unit tests for Risk Module (\u003e90% coverage)","description":"Comprehensive unit tests for risk metrics calculations.\n\nDeliverables:\n- tests/unit/test_risk.py (~200 lines)\n- ~10 unit tests across 3 test classes\n\nTest Classes:\n- TestCalculateExpectedValue (4 tests)\n  - Simple EV calculation\n  - Weighted probability validation\n  - Empty bins error\n  - Zero count error\n  \n- TestCalculateProbabilityOfProfit (4 tests)\n  - All profitable scenarios (PoP = 1.0)\n  - No profitable scenarios (PoP = 0.0)\n  - Partial profitable scenarios\n  - Breakeven not counted as profitable\n  \n- TestCalculateRiskMetrics (2 tests)\n  - Strategy validation before calculation\n  - Returns RiskMetrics object\n\nCoverage Target: \u003e90% for risk.py\n\nTest Helpers:\n- Fixtures for test strategies (covered call, straddle, etc.)\n- Helper functions for creating bins with specific P\u0026L profiles","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T21:42:14.457120414+01:00","updated_at":"2025-12-27T17:24:05.752265931+01:00","closed_at":"2025-12-27T17:24:05.752265931+01:00","close_reason":"Closed","dependencies":[{"issue_id":"option_returns-ukg","depends_on_id":"option_returns-eiu","type":"blocks","created_at":"2025-12-21T21:42:30.062444705+01:00","created_by":"daemon"}]}
{"id":"option_returns-wpx","title":"API Integration Tests","description":"Implement end-to-end integration tests: complete workflow, mixed expiration rejection, session lifecycle, error propagation, auto target date selection.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T18:53:50.520968915+01:00","updated_at":"2025-12-31T18:53:50.520968915+01:00","dependencies":[{"issue_id":"option_returns-wpx","depends_on_id":"option_returns-d95","type":"blocks","created_at":"2025-12-31T18:54:08.959336923+01:00","created_by":"daemon"},{"issue_id":"option_returns-wpx","depends_on_id":"option_returns-dmc","type":"blocks","created_at":"2025-12-31T18:54:08.981608274+01:00","created_by":"daemon"},{"issue_id":"option_returns-wpx","depends_on_id":"option_returns-u43","type":"blocks","created_at":"2025-12-31T18:54:09.002012412+01:00","created_by":"daemon"},{"issue_id":"option_returns-wpx","depends_on_id":"option_returns-qqe","type":"blocks","created_at":"2025-12-31T18:54:09.022524593+01:00","created_by":"daemon"},{"issue_id":"option_returns-wpx","depends_on_id":"option_returns-dse","type":"blocks","created_at":"2025-12-31T18:54:09.044439291+01:00","created_by":"daemon"},{"issue_id":"option_returns-wpx","depends_on_id":"option_returns-73q","type":"blocks","created_at":"2025-12-31T18:54:09.065940539+01:00","created_by":"daemon"},{"issue_id":"option_returns-wpx","depends_on_id":"option_returns-d6u","type":"blocks","created_at":"2025-12-31T18:54:09.086876329+01:00","created_by":"daemon"}]}
{"id":"option_returns-y7z","title":"Fix incorrect docstrings in Risk Module test fixtures","description":"Test fixtures in tests/unit/test_risk.py have incorrect documentation.\n\nIssue: Docstrings claim premium is 2.25 (midpoint) and max loss is -225, but:\n- Long positions pay ASK (2.5), not midpoint\n- Actual premium = 2.5 × 100 = 250\n- Transaction cost = 0.65\n- Actual max loss = -250.65\n- Actual breakeven = 105 + 2.5065 = 107.5065\n\nFixtures to fix:\n1. simple_long_call (lines 29-46)\n2. covered_call (lines 50-68)\n3. short_put (lines 72-89)\n\nAlso update in-test comments that reference '2.25 premium' to actual values.\n\nNote: Test code is correct, only documentation is wrong.\n\nSee: RISK_TESTS_REVIEW.md for full details","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-28T00:28:45.683596721+01:00","updated_at":"2025-12-28T00:28:45.683596721+01:00"}
{"id":"option_returns-yaf","title":"Phase 1: Foundation","description":"Project setup and core domain models\n\nTasks:\n- [ ] Project setup (pyproject.toml, directory structure)\n- [ ] Configuration management (including transaction costs, historical years)\n- [ ] Domain models (with validation, single-expiration check)\n- [ ] Custom exceptions (IBKRAPIError, validation errors)\n- [ ] Rate limiter utility\n- [ ] Unit tests for models and validation\n\nDeliverables:\n- Working domain models (Stock, OptionContract, OptionPosition, Strategy)\n- Validation logic (single-expiration, zero quantity)\n- Configuration with Pydantic settings\n- 90%+ test coverage for models","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-19T21:53:14.537949317+01:00","updated_at":"2025-12-19T22:06:41.351390928+01:00","closed_at":"2025-12-19T22:06:41.351390928+01:00","close_reason":"Phase 1 foundation complete with 94.63% test coverage"}
