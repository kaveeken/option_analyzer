{"id":"option_returns-0on","title":"Phase 2: Statistical Engine","description":"Price distribution modeling and risk metrics\n\nTasks:\n- [ ] Implement geometric returns, bootstrap\n- [ ] Direct returns vs Monte Carlo modes\n- [ ] Price range calculation (auto + user override)\n- [ ] Histogram binning\n- [ ] Risk metrics (EV, PoP) with transaction costs\n- [ ] Comprehensive unit tests\n- [ ] Performance benchmarks (bootstrap simulation)\n\nDeliverables:\n- Bootstrap simulation (10k samples \u003c5s)\n- Price distribution functions\n- Risk calculation engine\n- Test coverage \u003e90%\n\nSuccess Criteria:\n- 10,000 simulations complete in \u003c5 seconds\n- Price range auto-calculated with 5% padding\n- Transaction costs included in all metrics","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-19T21:53:21.821557539+01:00","updated_at":"2025-12-28T01:12:19.690085609+01:00","closed_at":"2025-12-28T01:12:19.690085609+01:00","close_reason":"All Phase 2 components implemented and tested: Statistics Module (i75), Risk Metrics Module (eiu), unit tests with \u003e90% coverage (ba7, ukg), and performance benchmarks validating \u003c5s for 10k simulations (eav). All deliverables complete.","dependencies":[{"issue_id":"option_returns-0on","depends_on_id":"option_returns-yaf","type":"blocks","created_at":"2025-12-19T21:54:20.9232971+01:00","created_by":"daemon"},{"issue_id":"option_returns-0on","depends_on_id":"option_returns-i75","type":"blocks","created_at":"2025-12-21T21:42:38.379669001+01:00","created_by":"daemon"},{"issue_id":"option_returns-0on","depends_on_id":"option_returns-eiu","type":"blocks","created_at":"2025-12-21T21:42:38.417580431+01:00","created_by":"daemon"},{"issue_id":"option_returns-0on","depends_on_id":"option_returns-ba7","type":"blocks","created_at":"2025-12-21T21:42:38.453247257+01:00","created_by":"daemon"},{"issue_id":"option_returns-0on","depends_on_id":"option_returns-ukg","type":"blocks","created_at":"2025-12-21T21:42:38.491892013+01:00","created_by":"daemon"},{"issue_id":"option_returns-0on","depends_on_id":"option_returns-eav","type":"blocks","created_at":"2025-12-21T21:42:38.52741603+01:00","created_by":"daemon"}]}
{"id":"option_returns-2n8","title":"Implement breakeven price calculation in Risk module","description":"Calculate breakeven prices where strategy.total_payoff(price) == 0.\n\nCurrently returns empty list (risk.py:198). Need to:\n- Find roots of total_payoff function across price range\n- Handle strategies with 0, 1, 2+ breakevens\n- Consider numerical precision for root finding\n- Add validation for edge cases\n\nDepends on: Risk module already has TODO comment marking this location.","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-27T17:19:30.171458018+01:00","updated_at":"2025-12-27T17:19:30.171458018+01:00"}
{"id":"option_returns-2zu","title":"Handle unbounded strategies in max_gain/max_loss calculation","description":"Current implementation (risk.py:191-194) calculates max gain/loss from histogram range only.\n\nIssue: For strategies with unlimited upside (e.g., long call) or downside (e.g., short call), should return None instead of histogram boundary values.\n\nApproach:\n- Detect unbounded strategies (check option positions for uncovered short/long)\n- Return None for max_gain when upside unlimited\n- Return None for max_loss when downside unlimited\n- RiskMetrics model already supports None for these fields\n\nBenefits: More accurate representation of true risk profile.","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-27T17:19:37.637555122+01:00","updated_at":"2025-12-27T17:19:37.637555122+01:00"}
{"id":"option_returns-444","title":"Remove symbol and underlying_price fields from OptionChain model","description":"Remove symbol and underlying_price fields from OptionChain domain model. These fields logically belong with the Stock object.\n\nChanges needed:\n1. src/option_analyzer/models/domain.py - Remove symbol and underlying_price field declarations, update docstring\n2. src/option_analyzer/clients/ibkr.py - Update get_unprice_option_chain to remove symbol parameter from OptionChain constructor\n3. tests/unit/test_models.py - Update 5 test methods that create OptionChain instances, remove test_option_chain_requires_positive_price test","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T12:08:19.31362233+01:00","updated_at":"2025-12-31T12:11:28.404397247+01:00","closed_at":"2025-12-31T12:11:28.404397247+01:00","close_reason":"Closed"}
{"id":"option_returns-4cu","title":"Document or validate negative days_to_expiry behavior","description":"The days_to_expiry() method can return negative values when reference_date is after expiration, but this is undocumented.\n\nIssues:\n- Unclear if negative values are intentional (for historical analysis) or a bug\n- No documentation about this edge case\n- No tests for past expiration scenarios\n- Calculations using this value might assume positive values\n\nSolution: Either add explicit documentation explaining negative values are allowed for historical analysis, OR add validation to raise ValueError if reference_date \u003e expiration.\n\nFile: src/option_analyzer/models/domain.py:90-101","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T09:22:09.487959694+01:00","updated_at":"2025-12-21T16:19:13.01000432+01:00","closed_at":"2025-12-21T16:19:13.01000432+01:00","close_reason":"Added validation to raise ValueError when reference_date is after expiration. Updated docstring and added comprehensive test coverage."}
{"id":"option_returns-4p7","title":"Validate that first IBKR secdef/search result is always correct","description":"In get_conid() and get_stock(), we assume the first result from IBKR secdef/search is the correct/SMART choice (see ibkr.py:129). This assumption is not validated. Need to investigate: 1) Whether IBKR guarantees ordering, 2) If we should match on additional fields (exchange, currency, etc), 3) Add validation/filtering logic if needed.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T20:30:17.691247097+01:00","updated_at":"2025-12-28T20:30:17.691247097+01:00"}
{"id":"option_returns-6ik","title":"Implement Historical Data Endpoint","description":"Implement get_historical_data(symbol, years) -\u003e dict method. Uses /historical/{conid} endpoint. Cache integration with 24h TTL. Mock-based unit tests. Returns data suitable for Phase 2 geometric returns calculation.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:51:16.468395338+01:00","updated_at":"2025-12-21T21:51:16.468395338+01:00","dependencies":[{"issue_id":"option_returns-6ik","depends_on_id":"option_returns-ouf","type":"blocks","created_at":"2025-12-21T21:51:25.687832717+01:00","created_by":"daemon"},{"issue_id":"option_returns-6ik","depends_on_id":"option_returns-7xh","type":"blocks","created_at":"2025-12-21T21:51:25.720928334+01:00","created_by":"daemon"}]}
{"id":"option_returns-7xh","title":"Implement Symbol Lookup Endpoint","description":"Implement get_conid(symbol: str) -\u003e int method in IBKRClient. Uses /search or /trsrv/stocks endpoint. Cache integration with 24h TTL. Mock-based unit tests for success and error cases (symbol not found, ambiguous, API down).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:51:15.412423802+01:00","updated_at":"2025-12-28T19:20:39.678496979+01:00","closed_at":"2025-12-28T19:20:39.678496979+01:00","close_reason":"Implemented comprehensive unit tests for Symbol Lookup Endpoint (get_conid). Created tests/unit/test_ibkr.py with 19 tests covering: success cases (basic lookup, caching, 24h TTL), error cases (symbol not found, invalid responses, connection errors, API errors), cache integration, asset type parameter handling, and edge cases. All tests passing (135/135 in full suite).","dependencies":[{"issue_id":"option_returns-7xh","depends_on_id":"option_returns-ouf","type":"blocks","created_at":"2025-12-21T21:51:24.616332689+01:00","created_by":"daemon"}]}
{"id":"option_returns-8we","title":"Change domain model conid field type from string to int","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T20:27:31.650998155+01:00","updated_at":"2025-12-30T21:39:20.44780183+01:00","closed_at":"2025-12-30T21:39:20.44780183+01:00","close_reason":"Closed"}
{"id":"option_returns-9jk","title":"Profile bootstrap performance and validate \u003c5s target","description":"Validate that NumPy vectorization achieves the 10k simulations in \u003c5s performance target.\n\nProfiling tasks:\n- Benchmark 10k simulations with varying steps (10, 50, 100)\n- Profile with cProfile to identify bottlenecks\n- Test with realistic historical data sizes (252, 1000, 5000 returns)\n- Measure memory usage for large simulations\n- Document hardware specs and results\n\nIf targets not met, investigate:\n- Batch processing for memory constraints\n- numba JIT compilation\n- Alternative sampling strategies\n- Chunking large simulations\n\nSuccess criteria:\n- 10k × 50 steps completes in \u003c5s on typical hardware\n- Memory usage acceptable for realistic datasets\n- Fallback strategy documented if needed\n\nFiles: src/option_analyzer/services/statistics.py (monte_carlo_simulation)\nTests: tests/performance/test_bootstrap.py\nRelated: Phase 2 Statistical Engine","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T21:55:07.492018349+01:00","updated_at":"2025-12-21T21:55:07.492018349+01:00"}
{"id":"option_returns-azx","title":"Add validate_for_analysis() method to Strategy","description":"Add a comprehensive validation method to Strategy that checks if it's ready for analysis.\n\nShould validate:\n- Single expiration (all options expire on same date)\n- All option positions have valid bid/ask data\n- At least one position exists (optional)\n\nLocation: src/option_analyzer/models/domain.py (Strategy class)\n\nImplementation:\ndef validate_for_analysis(self) -\u003e None:\n    if not self.validate_single_expiration():\n        raise MixedExpirationError()\n    for pos in self.option_positions:\n        if pos.contract.bid is None or pos.contract.ask is None:\n            raise MissingBidAskError(f'Missing price data for contract {pos.contract.conid}')\n\nBenefits:\n- Fail fast before expensive calculations\n- Clear error messages\n- Single method to call before any analysis\n- Can be extended with additional validations","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:12:42.378167697+01:00","updated_at":"2025-12-21T21:15:11.38169971+01:00","closed_at":"2025-12-21T21:15:11.38169971+01:00","close_reason":"Closed"}
{"id":"option_returns-b8y","title":"Phase 7: Polish \u0026 Deployment","description":"Final polish and deployment readiness\n\nTasks:\n- [ ] Logging \u0026 observability\n- [ ] Performance optimization\n- [ ] Documentation\n- [ ] Deployment guide\n\nDeliverables:\n- Structured logging\n- Performance monitoring\n- User documentation\n- Deployment instructions\n\nSuccess Criteria:\n- All success criteria met\n- Documentation complete\n- Ready for single-user local deployment","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-19T21:53:23.863301009+01:00","updated_at":"2025-12-19T21:53:23.863301009+01:00","dependencies":[{"issue_id":"option_returns-b8y","depends_on_id":"option_returns-iol","type":"blocks","created_at":"2025-12-19T21:54:21.153277891+01:00","created_by":"daemon"}]}
{"id":"option_returns-b96","title":"Implement Option Chain Endpoint","description":"Implement get_option_chain(symbol, expiration) -\u003e OptionChain method. Uses /option/chain or similar endpoint. Returns both calls and puts in structured OptionChain model. Cache integration with 15min TTL. Mock-based unit tests.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:51:16.107350909+01:00","updated_at":"2025-12-31T14:28:05.976203872+01:00","closed_at":"2025-12-31T14:28:05.976203872+01:00","close_reason":"Added comprehensive mock-based unit tests covering all option chain methods: get_option_strikes, get_unpriced_option_contract, get_unpriced_option_chain, price_option_chain, and get_option_chain. Tests verify success cases, caching (15min TTL), error handling, and batching logic. All 53 tests pass.","dependencies":[{"issue_id":"option_returns-b96","depends_on_id":"option_returns-ouf","type":"blocks","created_at":"2025-12-21T21:51:25.315638062+01:00","created_by":"daemon"},{"issue_id":"option_returns-b96","depends_on_id":"option_returns-7xh","type":"blocks","created_at":"2025-12-21T21:51:25.352957984+01:00","created_by":"daemon"},{"issue_id":"option_returns-b96","depends_on_id":"option_returns-clo","type":"blocks","created_at":"2025-12-30T14:38:09.148719122+01:00","created_by":"daemon"}]}
{"id":"option_returns-ba7","title":"Unit tests for Statistics Module (\u003e90% coverage)","description":"Comprehensive unit tests for all statistical functions.\n\nDeliverables:\n- tests/unit/test_statistics.py (~500 lines)\n- Test fixtures in tests/conftest.py (returns arrays, test data)\n- ~32 unit tests across 7 test classes\n\nTest Classes:\n- TestGeometricReturns (4 tests) - basic calc, multi-period, errors\n- TestCalculatePeriodForDays (3 tests) - daily/weekly/monthly bars\n- TestBootstrapWalk (3 tests) - deterministic with seed, positive results\n- TestMonteCarloSimulation (5 tests) - shape, all positive, errors\n- TestGetPriceDistribution (5 tests) - direct/MC modes, edge cases\n- TestCalculatePriceRange (5 tests) - auto, user override, validation\n- TestCreateHistogram (7 tests) - binning, max value edge case, properties\n\nCoverage Target: \u003e90% for statistics.py\n\nTest Patterns:\n- Class-based organization\n- Fixtures from conftest.py\n- pytest.approx() and np.allclose() for floats\n- RNG seeds for reproducibility\n- Comprehensive edge cases","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T21:41:38.749005618+01:00","updated_at":"2025-12-23T14:52:11.260275555+01:00","closed_at":"2025-12-23T14:52:11.260275555+01:00","close_reason":"Closed","dependencies":[{"issue_id":"option_returns-ba7","depends_on_id":"option_returns-i75","type":"blocks","created_at":"2025-12-21T21:42:30.019480042+01:00","created_by":"daemon"}]}
{"id":"option_returns-bec","title":"Remove unused covered_call fixture or add tests using it","description":"The covered_call fixture in tests/unit/test_risk.py is defined but never used.\n\nOptions:\n1. Remove the fixture if not needed (lines 50-68)\n2. Add test using it, e.g.:\n   - test_covered_call_max_gain_limited()\n   - test_covered_call_downside_protection()\n\nCovered call characteristics:\n- Long 100 shares at 100\n- Short call at strike 105\n- Premium collected: 200 (bid: 2.0 × 100)\n- Max gain: (105-100)*100 + 200 - 0.65 = 699.35\n- Max loss: Unlimited (stock can go to zero)\n\nRecommendation: Add test to validate capped upside behavior.\n\nSee: RISK_TESTS_REVIEW.md for suggestions","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-28T00:28:55.460644338+01:00","updated_at":"2025-12-28T00:28:55.460644338+01:00"}
{"id":"option_returns-clo","title":"Add OptionChain Domain Model","description":"Add OptionChain model to domain.py with fields: symbol (str), expiration (date), calls (list[OptionContract]), puts (list[OptionContract]), optional underlying_price (float | None). Includes unit tests for the model.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-30T14:38:01.623606434+01:00","updated_at":"2025-12-30T14:43:44.831548573+01:00","closed_at":"2025-12-30T14:43:44.831548573+01:00","close_reason":"Closed"}
{"id":"option_returns-cn1","title":"Implement differentiated cache TTL strategy for option chain endpoints","description":"Currently all option chain endpoints use a uniform 15-minute cache TTL. Implement a differentiated strategy based on data volatility:\n\n- Contract metadata (get_unpriced_option_contract): 24 hours (very stable - conid, strike, expiration don't change)\n- Option strikes (get_option_strikes): 1 hour (relatively stable for a given month)\n- Market snapshot prices (get_market_snapshot in price_option_chain): 5 minutes (changes frequently)\n\nBenefits:\n- Better performance through longer caching of stable data\n- Fresher pricing data with shorter TTL\n- Reduced API calls overall\n\nImplementation:\n- Replace hardcoded timedelta(minutes=15) calls in get_unpriced_option_chain and price_option_chain\n- Use timedelta(hours=24) for contract metadata\n- Use timedelta(hours=1) for strikes\n- Use timedelta(minutes=5) for pricing snapshots\n\nSee code review discussion for option 4 details.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-31T14:15:33.881068873+01:00","updated_at":"2025-12-31T14:15:33.881068873+01:00"}
{"id":"option_returns-dcz","title":"Phase 4: API Layer","description":"FastAPI routes with session management\n\nTasks:\n- [ ] Session state service with cookie management\n- [ ] Session cleanup background task (every 5 min)\n- [ ] Automatic target date selection (earliest expiration)\n- [ ] Request validation (Pydantic schemas)\n- [ ] Standardized error responses\n- [ ] FastAPI routes with session dependency injection\n- [ ] Position modification endpoints (PATCH, DELETE)\n- [ ] Strategy summary endpoint\n- [ ] Change reset to POST (not DELETE)\n- [ ] API integration tests with validation checks\n\nDeliverables:\n- All REST endpoints implemented\n- Session management with cookies\n- Validation and error handling\n- Auto-documentation at /docs\n\nSuccess Criteria:\n- Sessions persist across requests\n- Mixed expiration rejected with MIXED_EXPIRATION error\n- Auto target date selection works\n- All endpoints return standardized errors","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-19T21:53:22.714365181+01:00","updated_at":"2025-12-19T21:53:22.714365181+01:00","dependencies":[{"issue_id":"option_returns-dcz","depends_on_id":"option_returns-tgg","type":"blocks","created_at":"2025-12-19T21:54:21.018660374+01:00","created_by":"daemon"}]}
{"id":"option_returns-dia","title":"Modernize deprecated type hints to Python 3.11+ syntax","description":"Update deprecated typing imports and type hints to modern Python 3.11+ syntax.\n\nCurrent violations (8 total):\n- UP035: typing.List is deprecated, use list instead\n- UP006: Use list instead of List for type annotations\n- UP045: Use X | None instead of Optional[X]\n\nFiles affected:\n- src/option_analyzer/models/domain.py (lines 12, 33, 66-67, 90, 183, 235)\n- src/option_analyzer/config.py (line 38)\n\nChanges needed:\n- List[date] → list[date]\n- Optional[float] → float | None\n- Optional[date] → date | None\n- List[OptionPosition] → list[OptionPosition]\n\nSolution: Run 'ruff check --fix' to auto-fix all violations (~2 minutes work).\n\nThis should be done before Phase 2 to maintain modern Python standards.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T09:26:51.761246547+01:00","updated_at":"2025-12-21T16:10:22.348925618+01:00","closed_at":"2025-12-21T16:10:22.348925618+01:00","close_reason":"Closed"}
{"id":"option_returns-dmu","title":"Add IBKR Custom Exceptions","description":"Add 6 new exceptions to src/option_analyzer/utils/exceptions.py: IBKRAPIError, IBKRConnectionError, RateLimitExceededError, SymbolNotFoundError, InsufficientDataError, AmbiguousSymbolError","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:50:51.052583979+01:00","updated_at":"2025-12-23T15:29:49.316368046+01:00","closed_at":"2025-12-23T15:29:49.316368046+01:00","close_reason":"Closed"}
{"id":"option_returns-eav","title":"Performance tests and benchmarks (\u003c5s for 10k simulations)","description":"Performance validation and benchmarking for bootstrap simulation.\n\nDeliverables:\n- tests/performance/test_bootstrap.py (~50 lines)\n- Performance test results documentation\n\nPerformance Tests:\n- test_10k_simulations_under_5_seconds()\n  - 10,000 Monte Carlo simulations with 50 steps\n  - Assert completion in \u003c5 seconds\n  - Verify correct output shape\n  \n- test_vectorization_speedup()\n  - Compare vectorized vs loop implementation\n  - Document speedup factor\n  \n- test_large_dataset_binning()\n  - 100,000 values into 100 bins\n  - Assert completion in \u003c1 second\n\nSuccess Criteria:\n- All performance targets met\n- Vectorization confirmed working\n- Results documented for future regression testing\n\nNotes:\n- Use time.time() for timing\n- Run multiple iterations for stability\n- Document hardware specs in results","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T21:42:23.153528928+01:00","updated_at":"2025-12-24T01:26:20.235355754+01:00","closed_at":"2025-12-24T01:26:20.235355754+01:00","close_reason":"Implemented performance tests with all 4 tests passing:\n- test_10k_simulations_under_5_seconds: Validates 10k Monte Carlo simulations complete in \u003c5s\n- test_vectorization_speedup: Confirms vectorization provides 2x+ speedup vs loops  \n- test_large_dataset_binning: Verifies 100k values bin into 100 bins in \u003c1s\n- test_monte_carlo_scalability: Bonus test confirming linear scaling\n\nAll tests pass and meet performance targets. Code includes comprehensive docstrings and realistic test scenarios.","dependencies":[{"issue_id":"option_returns-eav","depends_on_id":"option_returns-i75","type":"blocks","created_at":"2025-12-21T21:42:30.105531869+01:00","created_by":"daemon"}]}
{"id":"option_returns-eiu","title":"Implement Risk Metrics Module (EV, PoP)","description":"Risk metrics calculation with Strategy integration.\n\nDeliverables:\n- src/option_analyzer/services/risk.py (~150 lines)\n- RiskMetrics Pydantic model (EV, PoP, max_gain, max_loss, breakevens)\n- calculate_expected_value() - probability-weighted P\u0026L\n- calculate_probability_of_profit() - fraction with P\u0026L \u003e 0\n- calculate_risk_metrics() - main entry point with validation\n\nTechnical Requirements:\n- Calls strategy.validate_for_analysis() before expensive calculations\n- Uses strategy.total_payoff(bin.midpoint) for P\u0026L evaluation\n- Weights by bin.count / total_count for probabilities\n- Comprehensive docstrings and type hints\n\nIntegration:\n- Depends on Statistics Module for PriceBin\n- Integrates with Strategy from domain.py\n- Uses transaction costs from config","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T21:40:44.003622384+01:00","updated_at":"2025-12-27T17:14:33.020861549+01:00","closed_at":"2025-12-27T17:14:33.020861549+01:00","close_reason":"Closed","dependencies":[{"issue_id":"option_returns-eiu","depends_on_id":"option_returns-i75","type":"blocks","created_at":"2025-12-21T21:42:29.975928721+01:00","created_by":"daemon"}]}
{"id":"option_returns-ept","title":"Add IBKR Configuration Settings","description":"Add missing config fields to Settings class: ibkr_verify_ssl, ibkr_max_retries, ibkr_retry_delay. Update default_historical_years if needed.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:50:50.371361085+01:00","updated_at":"2025-12-23T14:57:28.697073951+01:00","closed_at":"2025-12-23T14:57:28.697073951+01:00","close_reason":"Closed"}
{"id":"option_returns-f1q","title":"Validate trading days assumption (252/365 vs actual calendar)","description":"Current plan uses 252/365 ratio for trading day adjustments, which is a simplification that doesn't account for actual market holidays or different exchange calendars.\n\nInvestigation needed:\n- Measure error accumulation over typical analysis periods (30d, 60d, 1y)\n- Evaluate if precision is acceptable for expected use cases\n- Consider alternatives: actual trading day counts, exchange-specific calendars\n- Document decision rationale\n\nDecision criteria:\n- Is the error \u003c1% for typical periods?\n- Do we need exchange-specific calendars?\n- Does simplicity outweigh precision for MVP?\n\nFiles: src/option_analyzer/services/statistics.py (calculate_period_for_days)\nRelated: Phase 2 Statistical Engine","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T21:55:06.79737231+01:00","updated_at":"2025-12-21T21:55:06.79737231+01:00"}
{"id":"option_returns-gd3","title":"End-to-End Error Handling Tests","description":"Test all error conditions across endpoints. Verify retry logic with network failures. Verify rate limiting prevents bans. Test cache behavior under error conditions. Comprehensive unhappy path coverage.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:51:34.698794289+01:00","updated_at":"2025-12-21T21:51:34.698794289+01:00","dependencies":[{"issue_id":"option_returns-gd3","depends_on_id":"option_returns-7xh","type":"blocks","created_at":"2025-12-21T21:51:41.014937849+01:00","created_by":"daemon"},{"issue_id":"option_returns-gd3","depends_on_id":"option_returns-tbp","type":"blocks","created_at":"2025-12-21T21:51:41.050650422+01:00","created_by":"daemon"},{"issue_id":"option_returns-gd3","depends_on_id":"option_returns-b96","type":"blocks","created_at":"2025-12-21T21:51:41.090499614+01:00","created_by":"daemon"},{"issue_id":"option_returns-gd3","depends_on_id":"option_returns-6ik","type":"blocks","created_at":"2025-12-21T21:51:41.126291918+01:00","created_by":"daemon"}]}
{"id":"option_returns-gk1","title":"Phase 5: Visualization","description":"Strategy plot generation with matplotlib\n\nTasks:\n- [ ] Matplotlib chart generation (async with thread pool)\n- [ ] Per-session plot file naming\n- [ ] Plot directory creation and cleanup\n- [ ] Plot caching\n- [ ] Visual regression tests\n\nDeliverables:\n- Dual-axis chart (histogram + P\u0026L curve)\n- Session-isolated plot files\n- Async rendering (non-blocking)\n\nSuccess Criteria:\n- Plot generation doesn't block requests\n- Plots saved as /static/plots/{session_id}_{timestamp}.png\n- Old plots cleaned up with sessions","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-19T21:53:23.098098833+01:00","updated_at":"2025-12-19T21:53:23.098098833+01:00","dependencies":[{"issue_id":"option_returns-gk1","depends_on_id":"option_returns-dcz","type":"blocks","created_at":"2025-12-19T21:54:21.064077655+01:00","created_by":"daemon"}]}
{"id":"option_returns-gwz","title":"Refactor RateLimiter.acquire() to reduce cyclomatic complexity","description":"The acquire() method in rate_limiter.py has cyclomatic complexity of 7 due to duplicated cleanup logic.\n\nCurrent issues:\n- Cleanup logic repeated at lines 52-53 and 62-63\n- Nested while loops make testing edge cases harder\n- Difficult to maintain for future developers\n\nSolution: Extract cleanup as private _cleanup_expired_requests() method to eliminate duplication and reduce complexity.\n\nFile: src/option_analyzer/utils/rate_limiter.py:39-66","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T09:22:09.152376727+01:00","updated_at":"2025-12-21T16:19:28.151106582+01:00","closed_at":"2025-12-21T16:19:28.151106582+01:00","close_reason":"Closed"}
{"id":"option_returns-h04","title":"Raise MissingBidAskError when option price data is unavailable","description":"Currently OptionPosition.premium_paid defaults to 0.0 when bid/ask is None. This can lead to incorrect P\u0026L calculations. Update to raise MissingBidAskError instead to catch missing price data early.\n\nLocation: src/option_analyzer/models/domain.py:143-148\n\nChanges needed:\n- Update premium_paid property to validate bid/ask is not None\n- Raise MissingBidAskError with helpful message indicating which contract\n- Update tests to verify error is raised\n- Consider adding a has_price_data() helper method\n\nImpact: Prevents silent failures in analysis when price data is missing","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:12:42.041132593+01:00","updated_at":"2025-12-21T21:18:54.319050628+01:00","closed_at":"2025-12-21T21:18:54.319050628+01:00","close_reason":"Closed"}
{"id":"option_returns-h17","title":"Document expected IBKR API output formats","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T13:38:10.160743304+01:00","updated_at":"2025-12-31T13:38:10.160743304+01:00"}
{"id":"option_returns-i75","title":"Implement Statistics Module (geometric returns, bootstrap, histogram)","description":"Core statistical functions for price distribution modeling.\n\nDeliverables:\n- src/option_analyzer/services/statistics.py (~350 lines)\n- PriceBin Pydantic model with midpoint/width properties\n- geometric_returns() - calculate price multipliers\n- calculate_period_for_days() - trading day adjustment\n- bootstrap_walk() - single random walk\n- monte_carlo_simulation() - vectorized bootstrap (10k samples \u003c5s)\n- get_price_distribution() - direct + Monte Carlo modes\n- calculate_price_range() - auto with 5% padding + user override\n- create_histogram() - with max value edge case handling\n\nTechnical Requirements:\n- NumPy vectorization for performance\n- Comprehensive docstrings with Args/Returns/Raises/Examples\n- Type hints (Python 3.11+ syntax)\n- Input validation with clear error messages\n\nReferences:\n- Plan file: /var/home/kris/.claude/plans/purring-sparking-cookie.md\n- Integration: src/option_analyzer/models/domain.py","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T21:40:35.763673159+01:00","updated_at":"2025-12-21T22:00:33.049752525+01:00","closed_at":"2025-12-21T22:00:33.049752525+01:00","close_reason":"Implemented Statistics Module with all required components:\n- PriceBin Pydantic model with midpoint/width properties\n- geometric_returns() for price multiplier calculation\n- calculate_period_for_days() with trading day adjustment\n- bootstrap_walk() for single random walk simulation\n- monte_carlo_simulation() with vectorized NumPy (10k sims in 0.007s - way under 5s target!)\n- get_price_distribution() supporting both direct and Monte Carlo modes\n- calculate_price_range() with automatic 5% padding and user overrides\n- create_histogram() with proper max value edge case handling\n\nAll functions include comprehensive docstrings, Python 3.11+ type hints, input validation, and use NumPy vectorization for performance. Code passes ruff checks and integrates cleanly with existing test suite."}
{"id":"option_returns-iol","title":"Phase 6: Frontend","description":"Web UI with vanilla JavaScript\n\nTasks:\n- [ ] HTML/CSS structure\n- [ ] Loading state UI (spinners, disabled buttons)\n- [ ] Error display component\n- [ ] Modular JavaScript with state management\n- [ ] Position modification UI (edit, delete)\n- [ ] Strategy summary display\n- [ ] Analysis parameters controls (historical years, price range)\n- [ ] Event handling\n- [ ] Playwright E2E tests\n\nDeliverables:\n- Responsive web interface\n- Loading states for all operations\n- Position management UI\n- E2E test suite\n\nSuccess Criteria:\n- Mobile-responsive design\n- Loading states prevent user confusion\n- Errors display with clear messages\n- E2E tests cover critical user flows","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-19T21:53:23.479622932+01:00","updated_at":"2025-12-19T21:53:23.479622932+01:00","dependencies":[{"issue_id":"option_returns-iol","depends_on_id":"option_returns-gk1","type":"blocks","created_at":"2025-12-19T21:54:21.108735622+01:00","created_by":"daemon"}]}
{"id":"option_returns-jcq","title":"Implement Cache Interface and In-Memory Cache","description":"Create CacheInterface protocol in src/option_analyzer/clients/cache.py. Implement InMemoryCache with TTL support. Unit tests for cache behavior (set, get, expiration).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:50:50.717707001+01:00","updated_at":"2025-12-23T15:10:09.503828968+01:00","closed_at":"2025-12-23T15:10:09.503828968+01:00","close_reason":"Closed"}
{"id":"option_returns-k5z","title":"Integration Tests with Real IBKR (Optional)","description":"Real API tests marked with @pytest.mark.integration. Requires running IBKR Client Portal. Skip by default (pytest -m 'not integration'). Tests all endpoints with real API calls.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T21:51:34.36387961+01:00","updated_at":"2025-12-21T21:51:34.36387961+01:00","dependencies":[{"issue_id":"option_returns-k5z","depends_on_id":"option_returns-7xh","type":"blocks","created_at":"2025-12-21T21:51:40.580210385+01:00","created_by":"daemon"},{"issue_id":"option_returns-k5z","depends_on_id":"option_returns-tbp","type":"blocks","created_at":"2025-12-21T21:51:40.619117607+01:00","created_by":"daemon"},{"issue_id":"option_returns-k5z","depends_on_id":"option_returns-b96","type":"blocks","created_at":"2025-12-21T21:51:40.654815513+01:00","created_by":"daemon"},{"issue_id":"option_returns-k5z","depends_on_id":"option_returns-6ik","type":"blocks","created_at":"2025-12-21T21:51:40.690557371+01:00","created_by":"daemon"}]}
{"id":"option_returns-lmj","title":"Define histogram epsilon strategy for max value inclusion","description":"Histogram binning needs to ensure maximum values are included in the last bin, but the epsilon strategy is not specified in the plan.\n\nOptions to evaluate:\n1. Fixed epsilon: upper = max_value + 1e-10\n2. Relative epsilon: upper = max_value * 1.000001\n3. NumPy nextafter: upper = np.nextafter(max_value, np.inf)\n4. Inclusive comparison: last bin uses \u003c= instead of \u003c\n\nTrade-offs:\n- Numerical precision at extreme values\n- Readability and maintainability\n- Edge cases (very large/small values)\n- Performance implications\n\nDecision needed before finalizing create_histogram() implementation.\n\nFiles: src/option_analyzer/services/statistics.py (create_histogram)\nRelated: Phase 2 Statistical Engine","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T21:55:07.145596813+01:00","updated_at":"2025-12-21T21:55:07.145596813+01:00"}
{"id":"option_returns-lvz","title":"Fix URL encoding in symbol lookup endpoint","description":"Symbol and asset_type parameters in get_search_results() are concatenated directly into URL without encoding (ibkr.py:107). Symbols like 'BRK.B' or 'AT\u0026T' will break. Should use httpx params parameter or urllib.parse.urlencode(). Also add tests for special characters.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-28T19:31:16.837468939+01:00","updated_at":"2025-12-28T19:31:16.837468939+01:00"}
{"id":"option_returns-m3z","title":"Fix flaky performance test: test_monte_carlo_scalability","description":"The test_monte_carlo_scalability test in tests/performance/test_bootstrap.py is flaky because the implementation is too fast (1.31x scaling vs expected 1.5-3x).\n\nIssue: Test expects 10k simulations to take 1.5-3x longer than 5k simulations, but actual performance is better than expected due to NumPy/BLAS optimizations.\n\nError:\nAssertionError: Non-linear scaling detected: 1.31x\nassert 1.5 \u003c 1.3082012617325742\n\nOptions to fix:\n1. Adjust test tolerance to 1.0 \u003c scaling_ratio \u003c 3.0 (allows superlinear speedup)\n2. Remove the test entirely (primary \u003c5s target is already validated)\n3. Investigate and document the optimization cause\n\nLocation: tests/performance/test_bootstrap.py:152\n\nImpact: Breaks CI/CD but not a code quality issue - performance is better than expected.","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-28T00:39:12.642509217+01:00","updated_at":"2025-12-28T00:39:12.642509217+01:00"}
{"id":"option_returns-ouf","title":"Implement IBKRClient Base with Retry Logic","description":"Create src/option_analyzer/clients/ibkr.py with HTTPX client setup (base URL, timeout, SSL config). Integrate RateLimiter from Phase 1. Implement exponential backoff retry logic (1s-\u003e2s-\u003e4s, max 3 retries). Error response parsing and exception mapping.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T21:50:57.574629763+01:00","updated_at":"2025-12-28T01:00:45.57097192+01:00","closed_at":"2025-12-28T01:00:45.57097192+01:00","close_reason":"Closed","dependencies":[{"issue_id":"option_returns-ouf","depends_on_id":"option_returns-ept","type":"blocks","created_at":"2025-12-21T21:51:03.685011156+01:00","created_by":"daemon"},{"issue_id":"option_returns-ouf","depends_on_id":"option_returns-jcq","type":"blocks","created_at":"2025-12-21T21:51:03.722704133+01:00","created_by":"daemon"},{"issue_id":"option_returns-ouf","depends_on_id":"option_returns-dmu","type":"blocks","created_at":"2025-12-21T21:51:03.760869803+01:00","created_by":"daemon"}]}
{"id":"option_returns-qav","title":"Make symbol lookup cache TTL configurable","description":"get_conid() hardcodes 24h TTL (ibkr.py:122). Should be configurable via Settings for different environments (prod=24h, test=1m, etc.). Makes testing easier and more flexible.","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-28T19:31:17.160174265+01:00","updated_at":"2025-12-28T19:31:17.160174265+01:00"}
{"id":"option_returns-swf","title":"Implement validation for IBKR API output","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T13:38:10.534534851+01:00","updated_at":"2025-12-31T13:38:10.534534851+01:00","dependencies":[{"issue_id":"option_returns-swf","depends_on_id":"option_returns-h17","type":"blocks","created_at":"2025-12-31T13:38:15.118309098+01:00","created_by":"daemon"}]}
{"id":"option_returns-tbp","title":"Implement Stock Quote Endpoint","description":"Implement get_stock(symbol: str) -\u003e Stock method in IBKRClient. Uses search+snapshot endpoints (iserver/secdef/search + iserver/marketdata/snapshot). Returns Phase 1 Stock model. Cache integration with 5min TTL. Mock-based unit tests.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:51:15.75512055+01:00","updated_at":"2025-12-28T20:42:21.854528718+01:00","closed_at":"2025-12-28T20:42:21.854528718+01:00","close_reason":"Closed","dependencies":[{"issue_id":"option_returns-tbp","depends_on_id":"option_returns-ouf","type":"blocks","created_at":"2025-12-21T21:51:24.951717417+01:00","created_by":"daemon"},{"issue_id":"option_returns-tbp","depends_on_id":"option_returns-7xh","type":"blocks","created_at":"2025-12-21T21:51:24.987257303+01:00","created_by":"daemon"}]}
{"id":"option_returns-tgg","title":"Phase 3: IBKR Integration","description":"Interactive Brokers API client with rate limiting\n\nTasks:\n- [ ] HTTPX client with rate limiting\n- [ ] Retry logic with exponential backoff\n- [ ] Cache layer\n- [ ] Stock/chain/history endpoints (configurable years)\n- [ ] Error handling (IBKR down, symbol not found, rate limited)\n- [ ] Mock-based integration tests\n- [ ] Optional: Real IBKR integration tests\n\nDeliverables:\n- IBKRClient with rate limiting (50 req/60s)\n- Retry logic with exponential backoff\n- Cache interface with in-memory implementation\n- Comprehensive error handling\n\nSuccess Criteria:\n- Rate limiting prevents IBKR bans\n- Retries handle transient failures\n- Cache reduces redundant API calls","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-19T21:53:32.871650723+01:00","updated_at":"2025-12-19T21:53:32.871650723+01:00","dependencies":[{"issue_id":"option_returns-tgg","depends_on_id":"option_returns-ept","type":"blocks","created_at":"2025-12-21T21:51:46.499016456+01:00","created_by":"daemon"},{"issue_id":"option_returns-tgg","depends_on_id":"option_returns-jcq","type":"blocks","created_at":"2025-12-21T21:51:46.538582774+01:00","created_by":"daemon"},{"issue_id":"option_returns-tgg","depends_on_id":"option_returns-dmu","type":"blocks","created_at":"2025-12-21T21:51:46.575770185+01:00","created_by":"daemon"},{"issue_id":"option_returns-tgg","depends_on_id":"option_returns-ouf","type":"blocks","created_at":"2025-12-21T21:51:46.608143256+01:00","created_by":"daemon"},{"issue_id":"option_returns-tgg","depends_on_id":"option_returns-7xh","type":"blocks","created_at":"2025-12-21T21:51:46.64266624+01:00","created_by":"daemon"},{"issue_id":"option_returns-tgg","depends_on_id":"option_returns-tbp","type":"blocks","created_at":"2025-12-21T21:51:46.680152075+01:00","created_by":"daemon"},{"issue_id":"option_returns-tgg","depends_on_id":"option_returns-b96","type":"blocks","created_at":"2025-12-21T21:51:46.716036874+01:00","created_by":"daemon"},{"issue_id":"option_returns-tgg","depends_on_id":"option_returns-6ik","type":"blocks","created_at":"2025-12-21T21:51:46.75486191+01:00","created_by":"daemon"},{"issue_id":"option_returns-tgg","depends_on_id":"option_returns-gd3","type":"blocks","created_at":"2025-12-21T21:51:46.792694882+01:00","created_by":"daemon"}]}
{"id":"option_returns-tle","title":"Implement endpoint-specific rate limiting","description":"Implement weighted token acquisition for RateLimiter to handle IBKR's endpoint-specific rate limits. See RATE_LIMITING_PLAN.md for detailed implementation plan. Key changes: enhance RateLimiter.acquire() with tokens parameter, update IBKRClient to calculate and pass token weights for snapshot batching, add semaphore for history endpoint concurrency limits. Also fixes batching bug in price_option_chain() line 252.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T13:16:52.394939137+01:00","updated_at":"2025-12-31T13:16:52.394939137+01:00"}
{"id":"option_returns-ukg","title":"Unit tests for Risk Module (\u003e90% coverage)","description":"Comprehensive unit tests for risk metrics calculations.\n\nDeliverables:\n- tests/unit/test_risk.py (~200 lines)\n- ~10 unit tests across 3 test classes\n\nTest Classes:\n- TestCalculateExpectedValue (4 tests)\n  - Simple EV calculation\n  - Weighted probability validation\n  - Empty bins error\n  - Zero count error\n  \n- TestCalculateProbabilityOfProfit (4 tests)\n  - All profitable scenarios (PoP = 1.0)\n  - No profitable scenarios (PoP = 0.0)\n  - Partial profitable scenarios\n  - Breakeven not counted as profitable\n  \n- TestCalculateRiskMetrics (2 tests)\n  - Strategy validation before calculation\n  - Returns RiskMetrics object\n\nCoverage Target: \u003e90% for risk.py\n\nTest Helpers:\n- Fixtures for test strategies (covered call, straddle, etc.)\n- Helper functions for creating bins with specific P\u0026L profiles","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T21:42:14.457120414+01:00","updated_at":"2025-12-27T17:24:05.752265931+01:00","closed_at":"2025-12-27T17:24:05.752265931+01:00","close_reason":"Closed","dependencies":[{"issue_id":"option_returns-ukg","depends_on_id":"option_returns-eiu","type":"blocks","created_at":"2025-12-21T21:42:30.062444705+01:00","created_by":"daemon"}]}
{"id":"option_returns-y7z","title":"Fix incorrect docstrings in Risk Module test fixtures","description":"Test fixtures in tests/unit/test_risk.py have incorrect documentation.\n\nIssue: Docstrings claim premium is 2.25 (midpoint) and max loss is -225, but:\n- Long positions pay ASK (2.5), not midpoint\n- Actual premium = 2.5 × 100 = 250\n- Transaction cost = 0.65\n- Actual max loss = -250.65\n- Actual breakeven = 105 + 2.5065 = 107.5065\n\nFixtures to fix:\n1. simple_long_call (lines 29-46)\n2. covered_call (lines 50-68)\n3. short_put (lines 72-89)\n\nAlso update in-test comments that reference '2.25 premium' to actual values.\n\nNote: Test code is correct, only documentation is wrong.\n\nSee: RISK_TESTS_REVIEW.md for full details","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-28T00:28:45.683596721+01:00","updated_at":"2025-12-28T00:28:45.683596721+01:00"}
{"id":"option_returns-yaf","title":"Phase 1: Foundation","description":"Project setup and core domain models\n\nTasks:\n- [ ] Project setup (pyproject.toml, directory structure)\n- [ ] Configuration management (including transaction costs, historical years)\n- [ ] Domain models (with validation, single-expiration check)\n- [ ] Custom exceptions (IBKRAPIError, validation errors)\n- [ ] Rate limiter utility\n- [ ] Unit tests for models and validation\n\nDeliverables:\n- Working domain models (Stock, OptionContract, OptionPosition, Strategy)\n- Validation logic (single-expiration, zero quantity)\n- Configuration with Pydantic settings\n- 90%+ test coverage for models","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-19T21:53:14.537949317+01:00","updated_at":"2025-12-19T22:06:41.351390928+01:00","closed_at":"2025-12-19T22:06:41.351390928+01:00","close_reason":"Phase 1 foundation complete with 94.63% test coverage"}
